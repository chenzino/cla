<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude Code Monitor</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#8b7cf6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #08080c;
      --bg2: #0c0c12;
      --surface: rgba(255,255,255,0.03);
      --surface-hover: rgba(255,255,255,0.05);
      --surface-solid: #111118;
      --border: rgba(255,255,255,0.06);
      --border-hover: rgba(255,255,255,0.1);
      --text: #ebebf0;
      --text-secondary: #7a7a8e;
      --text-tertiary: #4a4a5e;
      --accent: #8b7cf6;
      --accent-dim: rgba(139,124,246,0.12);
      --accent-glow: rgba(139,124,246,0.25);
      --green: #34d399;
      --green-dim: rgba(52,211,153,0.1);
      --green-glow: rgba(52,211,153,0.25);
      --red: #fb7185;
      --red-dim: rgba(251,113,133,0.1);
      --yellow: #fbbf24;
      --yellow-dim: rgba(251,191,36,0.1);
      --radius: 16px;
      --radius-sm: 10px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ===== AMBIENT BACKGROUND ===== */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(139,124,246,0.04) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(52,211,153,0.03) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(139,124,246,0.02) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
      animation: ambientShift 20s ease-in-out infinite alternate;
    }

    @keyframes ambientShift {
      0% { transform: translate(0, 0) rotate(0deg); }
      100% { transform: translate(-2%, -1%) rotate(1deg); }
    }

    /* ===== AUTH GATE ===== */
    #auth-gate {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      flex-direction: column;
      gap: 24px;
      position: relative;
      z-index: 1;
    }

    .auth-logo {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--accent) 0%, #6366f1 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 700;
      color: white;
      box-shadow: 0 8px 32px rgba(139,124,246,0.3), 0 0 0 1px rgba(255,255,255,0.1) inset;
      margin-bottom: 4px;
    }

    #auth-gate h1 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text);
      letter-spacing: -0.02em;
    }

    #auth-gate .subtitle {
      color: var(--text-tertiary);
      font-size: 0.85rem;
      font-weight: 400;
      margin-top: -12px;
    }

    .auth-input-wrap {
      position: relative;
      width: 320px;
    }

    #auth-gate input {
      width: 100%;
      background: var(--surface-solid);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 14px 20px;
      font-family: 'Inter', sans-serif;
      font-size: 0.95rem;
      border-radius: var(--radius-sm);
      text-align: center;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
      letter-spacing: 2px;
    }

    #auth-gate input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim), 0 8px 24px rgba(0,0,0,0.3);
      background: #131320;
    }

    #auth-gate input::placeholder {
      color: var(--text-tertiary);
      letter-spacing: 1px;
    }

    .auth-error {
      color: var(--red);
      font-size: 0.8rem;
      height: 20px;
      font-weight: 500;
    }

    @keyframes shake { 0%,100%{transform:translateX(0)} 20%{transform:translateX(-10px)} 40%{transform:translateX(10px)} 60%{transform:translateX(-6px)} 80%{transform:translateX(6px)} }
    .shake { animation: shake 0.4s cubic-bezier(0.36,0.07,0.19,0.97); }

    /* ===== DASHBOARD ===== */
    #dashboard {
      display: none;
      padding: 24px 28px;
      max-width: 960px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in { animation: fadeUp 0.5s cubic-bezier(0.4,0,0.2,1) forwards; opacity: 0; }
    .fade-in:nth-child(1) { animation-delay: 0s; }
    .fade-in:nth-child(2) { animation-delay: 0.06s; }
    .fade-in:nth-child(3) { animation-delay: 0.12s; }
    .fade-in:nth-child(4) { animation-delay: 0.18s; }
    .fade-in:nth-child(5) { animation-delay: 0.24s; }

    /* ===== HEADER ===== */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 20px 0 24px;
      margin-bottom: 28px;
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .header-logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent) 0%, #6366f1 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      font-weight: 700;
      color: white;
      box-shadow: 0 4px 16px rgba(139,124,246,0.25);
      flex-shrink: 0;
    }

    .header-text h1 {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text);
      letter-spacing: -0.01em;
    }

    .header-text span {
      font-size: 0.72rem;
      color: var(--text-tertiary);
      font-weight: 400;
    }

    .header-right {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .conn-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.72rem;
      font-weight: 500;
      padding: 5px 12px;
      border-radius: 20px;
      transition: all 0.3s;
    }

    .conn-badge.ok {
      color: var(--green);
      background: var(--green-dim);
    }

    .conn-badge.err {
      color: var(--red);
      background: var(--red-dim);
    }

    .conn-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      animation: pulse 2.5s ease-in-out infinite;
    }

    .conn-badge.ok .conn-dot { background: var(--green); }
    .conn-badge.err .conn-dot { background: var(--red); }

    .btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 6px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: 0.75rem;
      font-weight: 500;
      transition: all 0.2s;
      backdrop-filter: blur(8px);
    }

    .btn:hover {
      border-color: var(--border-hover);
      color: var(--text);
      background: var(--surface-hover);
    }

    .btn-danger:hover {
      border-color: rgba(251,113,133,0.3);
      color: var(--red);
      background: var(--red-dim);
    }

    /* ===== HEADER NAV ===== */
    .header-nav {
      display: flex;
      gap: 2px;
      align-items: center;
    }

    .nav-link {
      color: var(--text-secondary);
      text-decoration: none;
      padding: 7px 16px;
      border-radius: 7px;
      font-size: 0.82rem;
      font-weight: 500;
      transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
      letter-spacing: -0.01em;
    }

    .nav-link:hover {
      color: var(--text);
      background: rgba(255,255,255,0.04);
    }

    .nav-link.active {
      background: var(--accent-dim);
      color: var(--accent);
    }

    /* ===== PAGES ===== */
    .page { display: none; opacity: 0; transition: opacity 0.25s ease; }
    .page.active { display: block; opacity: 1; }
    .page.fade-enter { opacity: 0; transform: translateY(8px); }
    .page.fade-active { opacity: 1; transform: translateY(0); transition: opacity 0.3s ease, transform 0.3s ease; }

    /* ===== LIVE CLOCK ===== */
    .header-clock {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.72rem;
      color: var(--text-tertiary);
      letter-spacing: 0.5px;
      text-align: right;
      line-height: 1.4;
    }
    .header-clock .clock-time {
      color: var(--text-secondary);
      font-size: 0.78rem;
      font-weight: 500;
    }

    /* ===== CARDS ===== */
    .cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      margin-bottom: 20px;
    }

    @media (max-width: 700px) {
      .cards { grid-template-columns: repeat(2, 1fr); }
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px 22px;
      backdrop-filter: blur(12px);
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent);
    }

    .card:hover {
      border-color: var(--border-hover);
      background: var(--surface-hover);
      transform: translateY(-1px);
    }

    .card .label {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text-tertiary);
      margin-bottom: 10px;
      font-weight: 500;
    }

    .card .value {
      font-size: 1.25rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
    }

    .card .value.active { color: var(--green); }
    .card .value.limited { color: var(--red); }
    .card .value.warning { color: var(--yellow); }
    .card .value.dim { color: var(--text-secondary); font-size: 0.88rem; font-weight: 500; }

    .status-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .status-dot.active {
      background: var(--green);
      box-shadow: 0 0 12px var(--green-glow);
      animation: pulse 2.5s ease-in-out infinite;
    }

    .status-dot.limited {
      background: var(--red);
      box-shadow: 0 0 12px rgba(251,113,133,0.4);
      animation: pulse 1.5s ease-in-out infinite;
    }

    .status-dot.idle {
      background: var(--yellow);
      box-shadow: 0 0 12px rgba(251,191,36,0.3);
      animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

    /* ===== SECTIONS ===== */
    .section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 16px;
      overflow: hidden;
      backdrop-filter: blur(12px);
      position: relative;
    }

    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
    }

    .section-header {
      padding: 16px 22px;
      border-bottom: 1px solid var(--border);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text-tertiary);
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* ===== ACTIVITY NOTE ===== */
    .notes-box {
      padding: 18px 22px;
      color: var(--text-secondary);
      font-size: 0.88rem;
      line-height: 1.6;
      font-weight: 400;
    }

    /* ===== LOG ===== */
    .log-viewer {
      padding: 8px 12px;
      max-height: 420px;
      overflow-y: auto;
      scroll-behavior: smooth;
    }

    .log-entry {
      padding: 10px 12px;
      border-radius: 8px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      transition: background 0.15s;
      margin: 2px 0;
    }

    .log-entry:hover {
      background: rgba(255,255,255,0.02);
    }

    .log-ts {
      color: var(--text-tertiary);
      white-space: nowrap;
      font-size: 0.72rem;
      font-family: 'JetBrains Mono', monospace;
      padding-top: 2px;
      min-width: 72px;
    }

    .log-type {
      padding: 2px 10px;
      border-radius: 6px;
      font-size: 0.65rem;
      text-transform: uppercase;
      white-space: nowrap;
      flex-shrink: 0;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .log-type.system { background: var(--accent-dim); color: var(--accent); }
    .log-type.output { background: var(--green-dim); color: var(--green); }
    .log-type.error { background: var(--red-dim); color: var(--red); }
    .log-type.user { background: var(--yellow-dim); color: var(--yellow); }
    .log-type.claude { background: var(--accent-dim); color: var(--accent); }

    .log-msg {
      color: var(--text);
      word-break: break-word;
      font-size: 0.84rem;
      line-height: 1.5;
      font-weight: 400;
    }

    /* ===== MESSAGE INPUT ===== */
    .msg-area {
      padding: 18px 22px;
    }

    .msg-area textarea {
      width: 100%;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 14px 16px;
      font-family: 'Inter', sans-serif;
      font-size: 0.88rem;
      border-radius: var(--radius-sm);
      resize: none;
      min-height: 88px;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
      line-height: 1.6;
    }

    .msg-area textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
      background: rgba(255,255,255,0.03);
    }

    .msg-area textarea::placeholder {
      color: var(--text-tertiary);
    }

    .send-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
    }

    .send-row .hint {
      font-size: 0.72rem;
      color: var(--text-tertiary);
      font-weight: 400;
    }

    .btn-send {
      background: linear-gradient(135deg, var(--accent), #6366f1);
      border: none;
      color: white;
      padding: 9px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: 0.82rem;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow: 0 2px 12px rgba(139,124,246,0.25);
      letter-spacing: 0.01em;
    }

    .btn-send:hover {
      box-shadow: 0 4px 24px rgba(139,124,246,0.4);
      transform: translateY(-1px);
    }

    .btn-send:active {
      transform: translateY(0);
    }

    .btn-send:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* ===== KANBAN BOARD ===== */
    .kanban-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .kanban-toolbar-title {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text-tertiary);
      font-weight: 600;
    }

    .btn-add-task {
      background: linear-gradient(135deg, var(--accent), #6366f1);
      border: none;
      color: white;
      padding: 8px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: 0.78rem;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow: 0 2px 12px rgba(139,124,246,0.25);
      letter-spacing: 0.01em;
    }

    .btn-add-task:hover {
      box-shadow: 0 4px 24px rgba(139,124,246,0.4);
      transform: translateY(-1px);
    }

    .kanban-add-form {
      display: none;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px 22px;
      margin-bottom: 16px;
      backdrop-filter: blur(12px);
      position: relative;
      overflow: hidden;
    }

    .kanban-add-form.visible {
      display: block;
    }

    .kanban-add-form::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
    }

    .kanban-form-row {
      margin-bottom: 12px;
    }

    .kanban-form-row:last-child {
      margin-bottom: 0;
    }

    .kanban-form-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-tertiary);
      font-weight: 500;
      margin-bottom: 6px;
      display: block;
    }

    .kanban-form-input {
      width: 100%;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 14px;
      font-family: 'Inter', sans-serif;
      font-size: 0.88rem;
      border-radius: 8px;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    }

    .kanban-form-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
      background: rgba(255,255,255,0.03);
    }

    .kanban-form-input::placeholder {
      color: var(--text-tertiary);
    }

    textarea.kanban-form-input {
      resize: none;
      min-height: 60px;
      line-height: 1.5;
    }

    .kanban-form-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 14px;
    }

    .kanban-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      min-height: 300px;
    }

    @media (max-width: 700px) {
      .kanban-board { grid-template-columns: 1fr; }
    }

    .kanban-column {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(12px);
      position: relative;
      overflow: hidden;
      transition: border-color 0.2s;
    }

    .kanban-column::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
    }

    .kanban-column.drag-over {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-dim);
    }

    .kanban-col-header {
      padding: 16px 18px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .kanban-col-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text-tertiary);
      font-weight: 600;
    }

    .kanban-col-count {
      font-size: 0.68rem;
      font-weight: 600;
      color: var(--text-tertiary);
      background: rgba(255,255,255,0.04);
      padding: 2px 8px;
      border-radius: 10px;
      min-width: 22px;
      text-align: center;
    }

    .kanban-col-tasks {
      padding: 10px;
      flex: 1;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .kanban-task-card {
      background: var(--surface-solid);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 14px 16px;
      cursor: grab;
      transition: all 0.2s cubic-bezier(0.4,0,0.2,1);
      position: relative;
    }

    /* Active / In-Progress column highlighting */
    .kanban-column[data-column-id="inprogress"] .kanban-task-card {
      border-color: rgba(139,124,246,0.25);
      background: linear-gradient(135deg, rgba(139,124,246,0.06) 0%, var(--surface-solid) 100%);
      box-shadow: 0 0 20px rgba(139,124,246,0.08);
    }
    .kanban-column[data-column-id="inprogress"] .kanban-task-card::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 2px;
      background: linear-gradient(90deg, var(--accent), #6366f1);
      border-radius: var(--radius-sm) var(--radius-sm) 0 0;
    }
    .kanban-column[data-column-id="inprogress"] .kanban-col-header {
      color: var(--accent);
    }
    .kanban-column[data-column-id="inprogress"] .kanban-col-count {
      background: var(--accent-dim);
      color: var(--accent);
    }
    .kanban-column[data-column-id="done"] .kanban-task-card {
      opacity: 0.6;
    }
    .kanban-column[data-column-id="done"] .kanban-task-card:hover {
      opacity: 0.85;
    }

    .kanban-task-card:hover {
      border-color: var(--border-hover);
      background: rgba(255,255,255,0.04);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    }

    .kanban-task-card.dragging {
      opacity: 0.4;
      transform: rotate(2deg);
    }

    .kanban-task-title {
      font-size: 0.84rem;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 4px;
      padding-right: 20px;
      line-height: 1.4;
    }

    .kanban-task-desc {
      font-size: 0.75rem;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 8px;
    }

    .kanban-task-actions {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .kanban-task-btn {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      color: var(--text-tertiary);
      width: 26px;
      height: 26px;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: 0.72rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      padding: 0;
      line-height: 1;
    }

    .kanban-task-btn:hover {
      border-color: var(--border-hover);
      color: var(--text);
      background: var(--surface-hover);
    }

    .kanban-task-btn.delete-btn:hover {
      border-color: rgba(251,113,133,0.3);
      color: var(--red);
      background: var(--red-dim);
    }

    .kanban-task-delete {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      color: var(--text-tertiary);
      width: 20px;
      height: 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.72rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      opacity: 0;
      padding: 0;
      line-height: 1;
    }

    .kanban-task-card:hover .kanban-task-delete {
      opacity: 1;
    }

    .kanban-task-delete:hover {
      color: var(--red);
      background: var(--red-dim);
    }

    .kanban-empty {
      color: var(--text-tertiary);
      font-size: 0.75rem;
      text-align: center;
      padding: 24px 12px;
      font-weight: 400;
    }

    /* ===== NOTE CARDS ===== */
    .note-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px 22px;
      margin-bottom: 12px;
      backdrop-filter: blur(12px);
      position: relative;
      transition: all 0.2s;
    }
    .note-card::before {
      content:'';position:absolute;top:0;left:0;right:0;height:1px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.05),transparent);
    }
    .note-card:hover { border-color: var(--border-hover); }
    .note-card-header { display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px; }
    .note-card-title { font-size:0.95rem;font-weight:600;color:var(--text); }
    .note-card-date { font-size:0.68rem;color:var(--text-tertiary);white-space:nowrap; }
    .note-card-content {
      font-size:0.84rem;color:var(--text-secondary);line-height:1.7;
      white-space:pre-wrap;word-break:break-word;
    }
    .note-card-actions {
      display:flex;gap:6px;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);
    }
    .note-empty { color:var(--text-tertiary);font-size:0.85rem;text-align:center;padding:40px; }
    .note-card.editing .note-card-content { display:none; }
    .note-edit-area {
      display:none;width:100%;background:rgba(255,255,255,0.02);border:1px solid var(--border);
      color:var(--text);padding:12px;font-family:'Inter',sans-serif;font-size:0.84rem;
      border-radius:8px;resize:vertical;min-height:100px;outline:none;line-height:1.6;
      margin-top:8px;
    }
    .note-card.editing .note-edit-area { display:block; }

    /* ===== HEALTH ITEMS ===== */
    .health-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--text-secondary);
    }
    .h-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-tertiary);
      flex-shrink: 0;
    }
    .h-dot.up { background: var(--green); box-shadow: 0 0 8px var(--green-glow); }
    .h-dot.down { background: var(--red); box-shadow: 0 0 8px rgba(251,113,133,0.4); }

    /* ===== FOOTER ===== */
    .footer {
      font-size: 0.7rem;
      color: var(--text-tertiary);
      text-align: center;
      padding: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .footer .dot {
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: var(--text-tertiary);
      opacity: 0.5;
    }

    .footer span { color: var(--accent); font-weight: 500; }

    /* ===== GALLERY ===== */
    .gallery-grid {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .gallery-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      backdrop-filter: blur(12px);
      transition: all 0.3s;
      position: relative;
    }
    .gallery-card::before {
      content:'';position:absolute;top:0;left:0;right:0;height:1px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.05),transparent);
    }
    .gallery-card:hover { border-color: var(--border-hover); }
    .gallery-art {
      padding: 28px 24px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.6rem;
      line-height: 1.2;
      white-space: pre;
      overflow-x: auto;
      text-align: left;
      min-height: 320px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .gallery-info {
      padding: 18px 24px;
      border-top: 1px solid var(--border);
    }
    .gallery-title { font-size: 0.95rem; font-weight: 600; color: var(--text); margin-bottom: 6px; }
    .gallery-desc {
      font-size: 0.78rem; color: var(--text-secondary); line-height: 1.7;
      white-space: pre-wrap; font-family: 'Inter', sans-serif;
    }

    /* ===== MOBILE RESPONSIVE ===== */
    @media (max-width: 600px) {
      #dashboard { padding: 12px 14px; }
      header { padding: 14px 0 16px; margin-bottom: 16px; }
      .header-logo { width: 30px; height: 30px; font-size: 13px; border-radius: 8px; }
      .header-text h1 { font-size: 0.82rem; }
      .header-text span { font-size: 0.65rem; }
      .header-left { gap: 10px; }
      .header-right { gap: 6px; }
      .conn-badge { font-size: 0.65rem; padding: 4px 8px; }
      .btn { font-size: 0.68rem; padding: 5px 10px; }

      .header-nav { gap: 0; }
      .nav-link { padding: 6px 10px; font-size: 0.72rem; }

      .cards { grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 16px; }
      .card { padding: 14px 16px; border-radius: 12px; }
      .card .label { font-size: 0.62rem; margin-bottom: 6px; }
      .card .value { font-size: 1.05rem; }
      .card .value.dim { font-size: 0.78rem; }

      .section { border-radius: 12px; margin-bottom: 12px; }
      .section-header { padding: 12px 16px; font-size: 0.68rem; }

      .health-item { font-size: 0.75rem; }
      #health-panel > div { gap: 8px !important; }
      #health-panel > div:last-child > div span { font-size: 0.62rem !important; }
      #health-panel > div:last-child > div div { font-size: 0.78rem !important; }

      .notes-box { padding: 14px 16px; font-size: 0.82rem; }

      .log-viewer { padding: 6px 8px; max-height: 320px; }
      .log-entry { padding: 8px; gap: 8px; flex-wrap: wrap; }
      .log-ts { font-size: 0.65rem; min-width: auto; }
      .log-type { font-size: 0.6rem; padding: 1px 6px; }
      .log-msg { font-size: 0.78rem; width: 100%; }

      .msg-area { padding: 14px 16px; }
      .msg-area textarea { font-size: 0.82rem; padding: 12px; min-height: 70px; }
      .send-row .hint { font-size: 0.65rem; max-width: 55%; }
      .btn-send { padding: 8px 18px; font-size: 0.78rem; }

      .kanban-toolbar { flex-wrap: wrap; gap: 10px; }
      .kanban-board { grid-template-columns: 1fr !important; }
      .kanban-column { min-height: auto; }
      .kanban-task-card { padding: 14px; }
      .kanban-form-input { font-size: 0.82rem; }
      .btn-add-task { font-size: 0.72rem; padding: 7px 14px; }

      .note-card { padding: 16px; }
      .note-card-title { font-size: 0.88rem; }
      .note-card-content { font-size: 0.78rem; }

      .footer { padding: 16px; font-size: 0.65rem; }

      .auth-logo { width: 48px; height: 48px; font-size: 20px; }
      #auth-gate h1 { font-size: 1.2rem; }
      #auth-gate input { width: 280px; font-size: 0.9rem; padding: 12px 16px; }
    }

    @media (max-width: 380px) {
      .cards { grid-template-columns: 1fr 1fr; gap: 8px; }
      .card .value { font-size: 0.95rem; }
      .status-dot { width: 6px; height: 6px; margin-right: 6px; }
      .header-text h1 { font-size: 0.75rem; }
      .nav-link { padding: 5px 8px; font-size: 0.68rem; }
    }

    /* ===== SCROLLBAR ===== */
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.12); }

    /* ===== TOAST ===== */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--surface-solid);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 12px 20px;
      font-size: 0.82rem;
      color: var(--text);
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      z-index: 100;
      animation: toastIn 0.3s cubic-bezier(0.4,0,0.2,1);
      backdrop-filter: blur(16px);
    }

    @keyframes toastIn {
      from { opacity: 0; transform: translateY(12px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .toast.fade-out {
      animation: toastOut 0.3s cubic-bezier(0.4,0,0.2,1) forwards;
    }

    @keyframes toastOut {
      to { opacity: 0; transform: translateY(8px) scale(0.95); }
    }

    .log-filter-btn.active {
      background: var(--accent-dim);
      color: var(--accent);
      border-color: rgba(139,124,246,0.2);
    }

    @keyframes confettiFall {
      0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) translateX(var(--drift)) rotate(var(--spin)); opacity: 0; }
    }

    /* ===== THEME TOGGLE ===== */
    .theme-toggle {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      width: 32px;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      transition: all 0.3s;
      flex-shrink: 0;
    }
    .theme-toggle:hover {
      border-color: var(--border-hover);
      color: var(--text);
      background: var(--surface-hover);
      transform: rotate(15deg);
    }

    /* Light theme overrides */
    body.light {
      --bg: #f5f5f7;
      --bg2: #eeeef0;
      --surface: rgba(0,0,0,0.03);
      --surface-hover: rgba(0,0,0,0.06);
      --surface-solid: #ffffff;
      --border: rgba(0,0,0,0.08);
      --border-hover: rgba(0,0,0,0.15);
      --text: #1a1a2e;
      --text-secondary: #555570;
      --text-tertiary: #8888a0;
      --accent: #6d5ce7;
      --accent-dim: rgba(109,92,231,0.1);
      --accent-glow: rgba(109,92,231,0.2);
      --green: #10b981;
      --green-dim: rgba(16,185,129,0.1);
      --green-glow: rgba(16,185,129,0.2);
      --red: #ef4444;
      --red-dim: rgba(239,68,68,0.1);
      --yellow: #f59e0b;
      --yellow-dim: rgba(245,158,11,0.1);
    }
    body.light::before {
      background:
        radial-gradient(ellipse at 20% 20%, rgba(109,92,231,0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(16,185,129,0.04) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(109,92,231,0.03) 0%, transparent 70%);
    }
    body.light .auth-logo,
    body.light .header-logo {
      box-shadow: 0 4px 16px rgba(109,92,231,0.2);
    }
    body.light ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); }
    body.light ::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.18); }

    /* ===== SKELETON LOADING ===== */
    @keyframes skeletonShimmer {
      0% { background-position: -200px 0; }
      100% { background-position: calc(200px + 100%) 0; }
    }
    .skeleton {
      background: linear-gradient(90deg, var(--surface) 0px, rgba(255,255,255,0.05) 40px, var(--surface) 80px);
      background-size: 200px 100%;
      animation: skeletonShimmer 1.5s ease-in-out infinite;
      border-radius: 6px;
    }
    body.light .skeleton {
      background: linear-gradient(90deg, rgba(0,0,0,0.04) 0px, rgba(0,0,0,0.08) 40px, rgba(0,0,0,0.04) 80px);
      background-size: 200px 100%;
    }
    .skeleton-line { height: 14px; margin-bottom: 8px; }
    .skeleton-line.short { width: 60%; }
    .skeleton-line.medium { width: 80%; }
    .skeleton-card { height: 80px; }

    /* ===== STATS BAR ===== */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }
    .stat-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 14px 16px;
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
      position: relative;
      overflow: hidden;
    }
    .stat-item::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .stat-item:hover::before { opacity: 1; }
    .stat-item:hover { transform: translateY(-2px); border-color: var(--border-hover); }
    .stat-number {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
      font-family: 'JetBrains Mono', monospace;
      letter-spacing: -0.02em;
      transition: all 0.3s;
    }
    .stat-number.counting { animation: countPop 0.3s ease; }
    @keyframes countPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    .stat-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-tertiary);
      margin-top: 4px;
      font-weight: 500;
    }

    /* ===== NOTIFICATION CENTER ===== */
    .notif-bell {
      position: relative;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      width: 32px;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      transition: all 0.3s;
      flex-shrink: 0;
    }
    .notif-bell:hover {
      border-color: var(--border-hover);
      color: var(--text);
      background: var(--surface-hover);
    }
    .notif-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: var(--red);
      color: white;
      font-size: 0.55rem;
      font-weight: 700;
      min-width: 16px;
      height: 16px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
      box-shadow: 0 2px 8px rgba(251,113,133,0.4);
      animation: notifPop 0.3s ease;
    }
    @keyframes notifPop {
      0% { transform: scale(0); }
      60% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .notif-badge:empty, .notif-badge[data-count="0"] { display: none; }
    .notif-dropdown {
      position: absolute;
      top: 40px;
      right: 0;
      width: 320px;
      max-height: 400px;
      overflow-y: auto;
      background: var(--surface-solid);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 12px 48px rgba(0,0,0,0.4);
      z-index: 150;
      display: none;
    }
    .notif-dropdown.open { display: block; }
    .notif-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .notif-clear {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 0.68rem;
      cursor: pointer;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
    }
    .notif-clear:hover { text-decoration: underline; }
    .notif-item {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      transition: background 0.15s;
      cursor: default;
    }
    .notif-item:last-child { border-bottom: none; }
    .notif-item:hover { background: var(--surface-hover); }
    .notif-item.unread { border-left: 3px solid var(--accent); }
    .notif-item-title {
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 2px;
    }
    .notif-item-time {
      font-size: 0.68rem;
      color: var(--text-tertiary);
    }
    .notif-empty {
      padding: 24px 16px;
      text-align: center;
      color: var(--text-tertiary);
      font-size: 0.82rem;
    }

    /* ===== MICRO-INTERACTIONS ===== */
    .btn, .btn-send, .btn-add-task, .kanban-task-btn, .nav-link {
      transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
    }
    .btn:active, .btn-send:active, .btn-add-task:active {
      transform: scale(0.96);
    }
    .card {
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1), box-shadow 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 8px 32px rgba(0,0,0,0.15), 0 0 0 1px var(--border-hover);
    }
    .kanban-task-card {
      transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
    }
    .kanban-task-card:hover {
      box-shadow: 0 8px 24px rgba(0,0,0,0.2), 0 0 0 1px var(--border-hover);
    }
    .note-card {
      transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
    }
    .note-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    .section {
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    .section:hover {
      border-color: var(--border-hover);
    }
    /* Ripple effect for buttons */
    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255,255,255,0.15);
      transform: scale(0);
      animation: rippleAnim 0.6s ease-out;
      pointer-events: none;
    }
    @keyframes rippleAnim {
      to { transform: scale(4); opacity: 0; }
    }

    @media (max-width: 600px) {
      .stats-bar { grid-template-columns: repeat(2, 1fr); gap: 8px; }
      .stat-item { padding: 10px 12px; }
      .stat-number { font-size: 1.2rem; }
      .notif-dropdown { width: 280px; right: -40px; }
      .cmd-palette { width: 90vw; max-width: 480px; }
      .pomodoro-widget { width: 280px; }
    }

    /* ===== COMMAND PALETTE ===== */
    .cmd-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      z-index: 500;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 15vh;
      backdrop-filter: blur(6px);
      animation: cmdFadeIn 0.15s ease;
    }
    @keyframes cmdFadeIn { from { opacity: 0; } to { opacity: 1; } }
    .cmd-palette {
      background: var(--surface-solid);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      width: 540px;
      max-width: 90vw;
      box-shadow: 0 24px 80px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.05) inset;
      overflow: hidden;
      animation: cmdSlideIn 0.2s cubic-bezier(0.16,1,0.3,1);
    }
    @keyframes cmdSlideIn { from { transform: translateY(-10px) scale(0.98); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
    .cmd-input-wrap {
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }
    .cmd-input {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--text);
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      outline: none;
      padding: 0;
    }
    .cmd-input::placeholder { color: var(--text-tertiary); }
    .cmd-results {
      max-height: 320px;
      overflow-y: auto;
      padding: 8px;
    }
    .cmd-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.1s;
      color: var(--text-secondary);
      font-size: 0.88rem;
    }
    .cmd-item:hover, .cmd-item.active {
      background: var(--accent-dim);
      color: var(--text);
    }
    .cmd-item .cmd-icon {
      width: 24px;
      text-align: center;
      font-size: 0.85rem;
      opacity: 0.7;
    }
    .cmd-item .cmd-label { flex: 1; }
    .cmd-item .cmd-shortcut {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.65rem;
      color: var(--text-tertiary);
      background: var(--surface);
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid var(--border);
    }
    .cmd-section {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-tertiary);
      padding: 8px 12px 4px;
      font-weight: 600;
    }

    /* ===== POMODORO TIMER ===== */
    .pomodoro-widget {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
      width: 300px;
      margin: 0 auto 16px;
    }
    .pomodoro-widget::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
    }
    .pomo-ring {
      position: relative;
      width: 160px;
      height: 160px;
      margin: 0 auto 16px;
    }
    .pomo-ring svg {
      width: 160px;
      height: 160px;
      transform: rotate(-90deg);
    }
    .pomo-ring .pomo-bg {
      fill: none;
      stroke: var(--border);
      stroke-width: 6;
    }
    .pomo-ring .pomo-progress {
      fill: none;
      stroke: var(--accent);
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 1s linear;
      filter: drop-shadow(0 0 6px var(--accent-glow));
    }
    .pomo-ring .pomo-progress.break-mode {
      stroke: var(--green);
      filter: drop-shadow(0 0 6px var(--green-glow));
    }
    .pomo-time {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'JetBrains Mono', monospace;
      font-size: 2rem;
      font-weight: 600;
      color: var(--text);
      letter-spacing: 2px;
    }
    .pomo-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 14px;
      font-weight: 500;
    }
    .pomo-controls {
      display: flex;
      gap: 8px;
      justify-content: center;
    }
    .pomo-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 8px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: 0.78rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    .pomo-btn:hover {
      border-color: var(--border-hover);
      color: var(--text);
      background: var(--surface-hover);
    }
    .pomo-btn.primary {
      background: linear-gradient(135deg, var(--accent), #6366f1);
      border: none;
      color: white;
      box-shadow: 0 2px 12px rgba(139,124,246,0.25);
    }
    .pomo-btn.primary:hover {
      box-shadow: 0 4px 20px rgba(139,124,246,0.4);
    }
    .pomo-sessions {
      margin-top: 12px;
      font-size: 0.7rem;
      color: var(--text-tertiary);
    }

    /* ===== CRT MODE ===== */
    body.crt {
      animation: crtFlicker 0.15s infinite;
    }
    body.crt * {
      text-shadow: 0 0 2px rgba(52,211,153,0.5);
    }
    @keyframes crtFlicker {
      0% { opacity: 0.97; }
      50% { opacity: 1; }
      100% { opacity: 0.98; }
    }
    body.crt::after {
      content: '';
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.15) 0px,
        rgba(0,0,0,0.15) 1px,
        transparent 1px,
        transparent 3px
      );
      pointer-events: none;
      z-index: 1000;
    }
    body.crt {
      --bg: #0a0f0a;
      --bg2: #0d120d;
      --surface: rgba(52,211,153,0.04);
      --surface-hover: rgba(52,211,153,0.08);
      --surface-solid: #0f150f;
      --border: rgba(52,211,153,0.12);
      --border-hover: rgba(52,211,153,0.2);
      --text: #34d399;
      --text-secondary: #2a9d6f;
      --text-tertiary: #1a6648;
      --accent: #34d399;
      --accent-dim: rgba(52,211,153,0.12);
      --accent-glow: rgba(52,211,153,0.3);
    }
    body.crt::before {
      background:
        radial-gradient(ellipse at 50% 50%, rgba(52,211,153,0.04) 0%, transparent 70%);
    }
    .crt-toggle {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      width: 32px;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      transition: all 0.3s;
      flex-shrink: 0;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
    }
    .crt-toggle:hover {
      border-color: var(--border-hover);
      color: var(--green);
      background: rgba(52,211,153,0.08);
      text-shadow: 0 0 8px var(--green-glow);
    }

    /* ===== FORTUNE COOKIE ===== */
    .fortune-cookie {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px 22px;
      margin-bottom: 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .fortune-cookie:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    .fortune-cookie::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
    }
    .fortune-icon { font-size: 2rem; margin-bottom: 8px; }
    .fortune-text {
      font-size: 0.88rem;
      color: var(--text-secondary);
      line-height: 1.6;
      font-style: italic;
      min-height: 24px;
    }
    .fortune-hint {
      font-size: 0.68rem;
      color: var(--text-tertiary);
      margin-top: 8px;
    }
    @keyframes fortuneCrack {
      0% { transform: scale(1); }
      15% { transform: scale(1.1) rotate(-5deg); }
      30% { transform: scale(0.9) rotate(5deg); }
      45% { transform: scale(1.15) rotate(-3deg); }
      60% { transform: scale(1); }
      100% { transform: scale(1); }
    }
    .fortune-cracking { animation: fortuneCrack 0.6s ease; }

    /* ===== SPARKLINE CHARTS ===== */
    .sparkline-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 14px;
      margin-bottom: 16px;
    }
    .sparkline-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px 18px;
      position: relative;
      overflow: hidden;
    }
    .sparkline-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
    }
    .sparkline-title {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-tertiary);
      font-weight: 500;
      margin-bottom: 6px;
    }
    .sparkline-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
      font-family: 'JetBrains Mono', monospace;
    }
    .sparkline-canvas {
      width: 100%;
      height: 40px;
    }

    /* ===== TERMINAL WIDGET ===== */
    .terminal-widget {
      background: #0d0d0d;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      font-family: 'JetBrains Mono', monospace;
      margin-bottom: 16px;
    }
    .terminal-bar {
      background: #1a1a1a;
      padding: 8px 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .terminal-dot { width: 10px; height: 10px; border-radius: 50%; }
    .terminal-dot.red { background: #ff5f57; }
    .terminal-dot.yellow { background: #febc2e; }
    .terminal-dot.green { background: #28c840; }
    .terminal-title {
      flex: 1;
      text-align: center;
      font-size: 0.72rem;
      color: #666;
    }
    .terminal-body {
      padding: 12px 16px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 0.78rem;
      line-height: 1.6;
      color: #34d399;
    }
    .terminal-body .prompt { color: #8b7cf6; }
    .terminal-body .output { color: #a0a0b0; }
    .terminal-body .error-text { color: #fb7185; }
    .terminal-input-line {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px 12px;
    }
    .terminal-prompt-text { color: #8b7cf6; font-size: 0.78rem; white-space: nowrap; }
    .terminal-input {
      flex: 1;
      background: transparent;
      border: none;
      color: #34d399;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.78rem;
      outline: none;
      caret-color: #34d399;
    }

    /* ===== TOOLS PAGE ===== */
    .tools-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 700px) {
      .tools-grid { grid-template-columns: 1fr; }
    }

    /* ===== TYPING TEST ===== */
    .typing-test {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      position: relative;
    }
    .typing-prompt {
      font-size: 0.92rem;
      line-height: 1.8;
      color: var(--text-secondary);
      margin-bottom: 16px;
      text-align: left;
      padding: 16px;
      background: rgba(0,0,0,0.15);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-family: 'JetBrains Mono', monospace;
      min-height: 80px;
      letter-spacing: 0.3px;
    }
    .typing-prompt .correct { color: var(--green); }
    .typing-prompt .incorrect { color: var(--red); background: var(--red-dim); border-radius: 2px; }
    .typing-prompt .cursor-char { border-bottom: 2px solid var(--accent); }
    .typing-input {
      width: 100%;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 12px 14px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.88rem;
      border-radius: var(--radius-sm);
      outline: none;
      transition: all 0.3s;
    }
    .typing-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
    }
    .typing-stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 14px;
    }
    .typing-stat-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--accent);
      font-family: 'JetBrains Mono', monospace;
    }
    .typing-stat-label {
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-tertiary);
      margin-top: 2px;
    }

    /* ===== SNAKE GAME ===== */
    .snake-container {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
      position: relative;
    }
    .snake-canvas {
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0a0a0f;
      display: block;
      margin: 0 auto 12px;
      image-rendering: pixelated;
    }
    .snake-score {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.82rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    .snake-best {
      font-size: 0.68rem;
      color: var(--text-tertiary);
      margin-top: 4px;
    }
    .snake-start-btn {
      background: linear-gradient(135deg, var(--green), #10b981);
      border: none;
      color: white;
      padding: 8px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: 0.82rem;
      font-weight: 600;
      transition: all 0.2s;
      box-shadow: 0 2px 12px rgba(52,211,153,0.25);
    }
    .snake-start-btn:hover { box-shadow: 0 4px 20px rgba(52,211,153,0.4); transform: translateY(-1px); }
  </style>
</head>
<body>

  <!-- AUTH GATE -->
  <div id="auth-gate">
    <div class="auth-logo">C</div>
    <h1>Claude Code Monitor</h1>
    <p class="subtitle">Enter password to continue</p>
    <div class="auth-input-wrap">
      <input type="password" id="password-input" placeholder="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" autofocus>
    </div>
    <p class="auth-error" id="auth-error"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard">
    <header class="fade-in">
      <div class="header-left">
        <div class="header-logo">C</div>
        <div class="header-text">
          <h1>Claude Code Monitor</h1>
          <span>chenzoo.com</span>
        </div>
      </div>
      <nav class="header-nav" id="main-nav">
        <a href="#" class="nav-link active" data-page="monitor">Monitor</a>
        <a href="#" class="nav-link" data-page="kanban">Kanban</a>
        <a href="#" class="nav-link" data-page="notes">Notes</a>
        <a href="#" class="nav-link" data-page="tools">Tools</a>
        <a href="#" class="nav-link" data-page="gallery">Gallery</a>
      </nav>
      <div class="header-right">
        <div class="header-clock" id="header-clock">
          <div class="clock-time">--:--:--</div>
          <div>up --:--</div>
        </div>
        <div class="conn-badge ok" id="conn-status">
          <div class="conn-dot"></div>
          <span>Connected</span>
        </div>
        <button class="theme-toggle" id="theme-toggle" title="Toggle theme">&#9790;</button>
        <button class="crt-toggle" id="crt-toggle" title="CRT Mode">CRT</button>
        <div style="position:relative;">
          <button class="notif-bell" id="notif-bell" title="Notifications">&#128276;</button>
          <span class="notif-badge" id="notif-badge"></span>
          <div class="notif-dropdown" id="notif-dropdown">
            <div class="notif-header">
              <span>Notifications</span>
              <button class="notif-clear" id="notif-clear">Clear all</button>
            </div>
            <div id="notif-list">
              <div class="notif-empty">No notifications yet</div>
            </div>
          </div>
        </div>
        <button class="btn btn-danger" id="logout-btn">Logout</button>
      </div>
    </header>

    <!-- MONITOR PAGE -->
    <div id="page-monitor" class="page active">
      <div class="cards fade-in">
        <div class="card">
          <div class="label">Status</div>
          <div class="value" id="card-status"><span class="status-dot active"></span>Loading</div>
        </div>
        <div class="card">
          <div class="label">Usage</div>
          <div class="value" id="card-limit">--</div>
        </div>
        <div class="card">
          <div class="label">Resets In</div>
          <div class="value" id="card-reset">--</div>
        </div>
        <div class="card">
          <div class="label">Last Sync</div>
          <div class="value dim" id="card-updated">--</div>
        </div>
      </div>

      <!-- STATS BAR -->
      <div class="stats-bar fade-in" id="stats-bar">
        <div class="stat-item">
          <div class="stat-number" id="stat-tasks">-</div>
          <div class="stat-label">Total Tasks</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="stat-done">-</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="stat-notes">-</div>
          <div class="stat-label">Notes</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="stat-messages">-</div>
          <div class="stat-label">Messages</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="stat-uptime">-</div>
          <div class="stat-label">Days Up</div>
        </div>
      </div>

      <!-- SPARKLINE CHARTS -->
      <div class="sparkline-row fade-in">
        <div class="sparkline-card">
          <div class="sparkline-title">CPU Load</div>
          <div class="sparkline-value" id="spark-cpu-val">--</div>
          <canvas class="sparkline-canvas" id="spark-cpu" width="200" height="40"></canvas>
        </div>
        <div class="sparkline-card">
          <div class="sparkline-title">Memory Usage</div>
          <div class="sparkline-value" id="spark-mem-val">--</div>
          <canvas class="sparkline-canvas" id="spark-mem" width="200" height="40"></canvas>
        </div>
        <div class="sparkline-card">
          <div class="sparkline-title">API Requests</div>
          <div class="sparkline-value" id="spark-req-val">--</div>
          <canvas class="sparkline-canvas" id="spark-req" width="200" height="40"></canvas>
        </div>
      </div>

      <!-- DAILY QUOTE -->
      <div class="section fade-in" id="quote-section" style="padding:16px 22px;">
        <div style="display:flex;align-items:flex-start;gap:12px;">
          <span style="font-size:1.5rem;color:var(--accent);line-height:1;opacity:0.5;">"</span>
          <div>
            <div id="daily-quote" style="font-size:0.84rem;color:var(--text-secondary);line-height:1.6;font-style:italic;">Loading wisdom...</div>
            <div id="quote-author" style="font-size:0.72rem;color:var(--text-tertiary);margin-top:6px;"></div>
          </div>
        </div>
      </div>

      <!-- POMODORO TIMER + FORTUNE -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;" class="fade-in">
        <div class="pomodoro-widget" style="width:100%;margin:0;">
          <div class="pomo-ring">
            <svg viewBox="0 0 160 160">
              <circle class="pomo-bg" cx="80" cy="80" r="70"/>
              <circle class="pomo-progress" id="pomo-progress" cx="80" cy="80" r="70"
                stroke-dasharray="439.82" stroke-dashoffset="0"/>
            </svg>
            <div class="pomo-time" id="pomo-time">25:00</div>
          </div>
          <div class="pomo-label" id="pomo-label">Focus Time</div>
          <div class="pomo-controls">
            <button class="pomo-btn primary" id="pomo-start">Start</button>
            <button class="pomo-btn" id="pomo-reset">Reset</button>
          </div>
          <div class="pomo-sessions" id="pomo-sessions">Sessions: 0</div>
        </div>

        <div class="fortune-cookie" id="fortune-cookie">
          <div class="fortune-icon" id="fortune-icon">&#127840;</div>
          <div class="fortune-text" id="fortune-text">Click to crack open a fortune cookie...</div>
          <div class="fortune-hint" id="fortune-hint">Tap for developer wisdom</div>
        </div>
      </div>

      <!-- SYSTEM HEALTH -->
      <div class="section fade-in">
        <div class="section-header">System Health</div>
        <div style="padding:16px 22px;" id="health-panel">
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;">
            <div class="health-item" id="h-claude"><span class="h-dot"></span>Claude Code</div>
            <div class="health-item" id="h-server"><span class="h-dot"></span>Server</div>
            <div class="health-item" id="h-tunnel"><span class="h-dot"></span>Tunnel</div>
            <div class="health-item" id="h-monitor"><span class="h-dot"></span>Monitor</div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
            <div><span style="font-size:0.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-tertiary);font-weight:500;">Uptime</span><div style="font-size:0.88rem;color:var(--text);margin-top:4px;" id="h-uptime">--</div></div>
            <div><span style="font-size:0.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-tertiary);font-weight:500;">Memory</span><div style="font-size:0.88rem;color:var(--text);margin-top:4px;" id="h-memory">--</div></div>
            <div><span style="font-size:0.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-tertiary);font-weight:500;">Disk</span><div style="font-size:0.88rem;color:var(--text);margin-top:4px;" id="h-disk">--</div></div>
            <div><span style="font-size:0.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-tertiary);font-weight:500;">Load</span><div style="font-size:0.88rem;color:var(--text);margin-top:4px;" id="h-load">--</div></div>
          </div>
        </div>
      </div>

      <div class="section fade-in">
        <div class="section-header">Current Activity</div>
        <div class="notes-box" id="notes-box">Loading...</div>
      </div>

      <div class="section fade-in">
        <div class="section-header">
          Activity Log
          <div style="display:flex;gap:6px;align-items:center;">
            <div id="log-filters" style="display:flex;gap:3px;">
              <button class="btn log-filter-btn active" data-type="all" style="padding:3px 8px;font-size:0.65rem;">All</button>
              <button class="btn log-filter-btn" data-type="system" style="padding:3px 8px;font-size:0.65rem;">System</button>
              <button class="btn log-filter-btn" data-type="user" style="padding:3px 8px;font-size:0.65rem;">User</button>
              <button class="btn log-filter-btn" data-type="error" style="padding:3px 8px;font-size:0.65rem;">Error</button>
            </div>
            <button class="btn" id="export-logs-btn" style="padding:3px 8px;font-size:0.65rem;">Export</button>
            <button class="btn" id="refresh-btn">Refresh</button>
          </div>
        </div>
        <div class="log-viewer" id="log-viewer">
          <div class="log-entry"><span class="log-msg" style="color:var(--text-tertiary)">Loading...</span></div>
        </div>
      </div>

      <div class="section fade-in">
        <div class="section-header">Message Claude</div>
        <div class="msg-area">
          <textarea id="msg-input" placeholder="Send a message or instruction to Claude Code..."></textarea>
          <div class="send-row">
            <span class="hint">Delivered directly to the active session</span>
            <button class="btn-send" id="send-btn">Send</button>
          </div>
        </div>
      </div>
    </div>

    <!-- KANBAN PAGE -->
    <div id="page-kanban" class="page">
      <div class="kanban-toolbar fade-in">
        <span class="kanban-toolbar-title">Task Board</span>
        <button class="btn-add-task" id="add-task-btn">+ Add Task</button>
      </div>

      <div class="kanban-add-form fade-in" id="kanban-add-form">
        <div class="kanban-form-row">
          <label class="kanban-form-label">Title</label>
          <input type="text" class="kanban-form-input" id="kanban-task-title" placeholder="Task title...">
        </div>
        <div class="kanban-form-row">
          <label class="kanban-form-label">Description (optional)</label>
          <textarea class="kanban-form-input" id="kanban-task-desc" placeholder="Brief description..."></textarea>
        </div>
        <div class="kanban-form-actions">
          <button class="btn" id="cancel-task-btn">Cancel</button>
          <button class="btn-send" id="save-task-btn" style="padding:8px 18px;font-size:0.78rem;">Save Task</button>
        </div>
      </div>

      <div class="kanban-board fade-in" id="kanban-board">
        <!-- Columns rendered by JS -->
      </div>
    </div>

    <!-- NOTES PAGE -->
    <div id="page-notes" class="page">
      <div class="kanban-toolbar fade-in">
        <span class="kanban-toolbar-title">Notes</span>
        <div style="display:flex;gap:8px;align-items:center;">
          <input type="text" id="note-search" class="kanban-form-input" placeholder="Search notes..." style="width:200px;padding:7px 12px;font-size:0.78rem;">
          <button class="btn" id="export-notes-btn" style="white-space:nowrap;">Export</button>
          <button class="btn-add-task" id="add-note-btn">+ New Note</button>
        </div>
      </div>

      <div class="kanban-add-form fade-in" id="note-add-form">
        <div class="kanban-form-row">
          <label class="kanban-form-label">Title</label>
          <input type="text" class="kanban-form-input" id="note-title" placeholder="Note title...">
        </div>
        <div class="kanban-form-row">
          <label class="kanban-form-label">Content</label>
          <textarea class="kanban-form-input" id="note-content" placeholder="Write your note..." style="min-height:120px;"></textarea>
        </div>
        <div class="kanban-form-actions">
          <button class="btn" id="cancel-note-btn">Cancel</button>
          <button class="btn-send" id="save-note-btn" style="padding:8px 18px;font-size:0.78rem;">Save Note</button>
        </div>
      </div>

      <div id="notes-list" class="fade-in"></div>
    </div>

    <!-- TOOLS PAGE -->
    <div id="page-tools" class="page">
      <div class="kanban-toolbar fade-in">
        <span class="kanban-toolbar-title">Developer Tools</span>
      </div>

      <!-- Terminal Emulator -->
      <div class="terminal-widget fade-in">
        <div class="terminal-bar">
          <div class="terminal-dot red"></div>
          <div class="terminal-dot yellow"></div>
          <div class="terminal-dot green"></div>
          <div class="terminal-title">claude-monitor ~ bash</div>
        </div>
        <div class="terminal-body" id="terminal-body">
          <div><span class="output">Welcome to Claude Monitor Terminal v1.0</span></div>
          <div><span class="output">Type 'help' for available commands.</span></div>
        </div>
        <div class="terminal-input-line">
          <span class="terminal-prompt-text">guest@claude ~$</span>
          <input class="terminal-input" id="terminal-input" type="text" autofocus spellcheck="false">
        </div>
      </div>

      <!-- Typing Test + Snake Game side by side -->
      <div class="tools-grid fade-in">
        <div class="typing-test">
          <div style="font-size:0.72rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);font-weight:600;margin-bottom:14px;">Typing Speed Test</div>
          <div class="typing-prompt" id="typing-prompt">Click "Start" to begin...</div>
          <input class="typing-input" id="typing-input" placeholder="Start typing..." disabled>
          <div style="display:flex;gap:8px;justify-content:center;margin-top:12px;">
            <button class="pomo-btn primary" id="typing-start">Start</button>
            <button class="pomo-btn" id="typing-reset">Reset</button>
          </div>
          <div class="typing-stats">
            <div class="typing-stat"><div class="typing-stat-value" id="typing-wpm">0</div><div class="typing-stat-label">WPM</div></div>
            <div class="typing-stat"><div class="typing-stat-value" id="typing-acc">0%</div><div class="typing-stat-label">Accuracy</div></div>
            <div class="typing-stat"><div class="typing-stat-value" id="typing-best">0</div><div class="typing-stat-label">Best</div></div>
          </div>
        </div>

        <div class="snake-container">
          <div style="font-size:0.72rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);font-weight:600;margin-bottom:14px;">Snake Game</div>
          <canvas class="snake-canvas" id="snake-canvas" width="280" height="280"></canvas>
          <div class="snake-score" id="snake-score">Score: 0</div>
          <button class="snake-start-btn" id="snake-start">Play</button>
          <div class="snake-best" id="snake-best">Best: 0</div>
        </div>
      </div>
    </div>

    <!-- GALLERY PAGE -->
    <div id="page-gallery" class="page">
      <div class="kanban-toolbar fade-in">
        <span class="kanban-toolbar-title">ASCII Loom Gallery</span>
      </div>
      <div class="gallery-grid fade-in" id="gallery-grid"></div>
    </div>

    <div class="footer fade-in">
      Auto-refresh <span>15s</span>
      <div class="dot"></div>
      Powered by Claude Code
    </div>
  </div>

  <script>
    let authToken = null;
    let kanbanData = null;

    const pwInput = document.getElementById('password-input');
    const authErr = document.getElementById('auth-error');

    const stored = sessionStorage.getItem('monitor_token');
    if (stored) { authToken = stored; showDashboard(); }

    pwInput.addEventListener('keydown', async (e) => {
      if (e.key !== 'Enter') return;
      authErr.textContent = '';
      try {
        const resp = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: pwInput.value })
        });
        const data = await resp.json();
        if (data.ok) {
          authToken = data.token;
          sessionStorage.setItem('monitor_token', authToken);
          showDashboard();
        } else {
          authErr.textContent = data.error || 'Incorrect password';
          pwInput.value = '';
          pwInput.classList.add('shake');
          setTimeout(() => pwInput.classList.remove('shake'), 500);
        }
      } catch (err) {
        authErr.textContent = 'Connection failed';
      }
    });

    function showDashboard() {
      document.getElementById('auth-gate').style.display = 'none';
      const dash = document.getElementById('dashboard');
      dash.style.display = 'block';
      navigateTo('monitor');
      fetchStatus();
      fetchHealth();
      setInterval(fetchStatus, 15000);
      setInterval(fetchHealth, 30000);
    }

    document.getElementById('logout-btn').addEventListener('click', () => {
      sessionStorage.removeItem('monitor_token');
      authToken = null;
      location.reload();
    });

    function api(path, opts = {}) {
      return fetch(path, {
        ...opts,
        headers: { 'Authorization': 'Bearer ' + authToken, 'Content-Type': 'application/json', ...opts.headers }
      });
    }

    // ===== PAGE NAVIGATION =====
    const PAGES = ['monitor', 'kanban', 'notes', 'tools', 'gallery'];
    let currentPage = 'monitor';

    function navigateTo(page) {
      if (page === currentPage && document.getElementById('page-' + page).style.display === 'block') return;
      // Update nav links
      document.querySelectorAll('#main-nav .nav-link').forEach(link => {
        if (link.dataset.page === page) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
      // Hide old page, show new with animation
      PAGES.forEach(p => {
        const el = document.getElementById('page-' + p);
        if (!el) return;
        if (p === page) {
          el.style.display = 'block';
          el.classList.remove('fade-enter');
          // Trigger reflow for animation
          void el.offsetWidth;
          el.classList.add('fade-enter');
          requestAnimationFrame(() => {
            el.classList.remove('fade-enter');
            el.classList.add('fade-active');
            el.style.opacity = '1';
          });
        } else {
          el.style.display = 'none';
          el.style.opacity = '0';
          el.classList.remove('fade-active');
        }
      });
      currentPage = page;
      // Load data for the page
      if (page === 'kanban') fetchKanban();
      if (page === 'notes') fetchNotes();
      if (page === 'gallery') renderGallery();
    }

    // Wire up nav clicks
    document.querySelectorAll('#main-nav .nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        navigateTo(link.dataset.page);
      });
    });

    // ===== LIVE CLOCK =====
    const sessionStart = Date.now();
    function updateClock() {
      const now = new Date();
      const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      const elapsed = Date.now() - sessionStart;
      const h = Math.floor(elapsed / 3600000);
      const m = Math.floor((elapsed % 3600000) / 60000);
      const s = Math.floor((elapsed % 60000) / 1000);
      const uptime = h > 0 ? h + 'h ' + m + 'm' : m + 'm ' + s + 's';
      const el = document.getElementById('header-clock');
      if (el) {
        el.innerHTML = '<div class="clock-time">' + time + '</div><div>up ' + uptime + '</div>';
      }
    }
    setInterval(updateClock, 1000);
    updateClock();

    // ===== HEALTH =====
    async function fetchHealth() {
      try {
        const resp = await api('/api/health');
        if (!resp.ok) return;
        const h = await resp.json();

        const setDot = (id, up) => {
          const el = document.querySelector('#' + id + ' .h-dot');
          if (el) { el.className = 'h-dot ' + (up ? 'up' : 'down'); }
        };
        setDot('h-claude', h.processes.claude);
        setDot('h-server', h.processes.server);
        setDot('h-tunnel', h.processes.tunnel);
        setDot('h-monitor', h.processes.monitor);

        document.getElementById('h-uptime').textContent = h.system.uptime || '--';
        if (h.system.memory.totalMB) {
          const pct = Math.round((h.system.memory.usedMB / h.system.memory.totalMB) * 100);
          document.getElementById('h-memory').textContent = h.system.memory.usedMB + ' / ' + h.system.memory.totalMB + ' MB (' + pct + '%)';
        }
        if (h.system.disk.used) {
          document.getElementById('h-disk').textContent = h.system.disk.used + ' / ' + h.system.disk.total + ' (' + h.system.disk.usePercent + ')';
        }
        document.getElementById('h-load').textContent = h.system.loadAvg || '--';
      } catch (e) {}
    }

    // ===== MONITOR FUNCTIONS =====
    async function fetchStatus() {
      const connEl = document.getElementById('conn-status');
      try {
        const resp = await api('/api/status');
        if (resp.status === 401) { logout(); return; }
        const data = await resp.json();
        connEl.innerHTML = '<div class="conn-dot"></div><span>Connected</span>';
        connEl.className = 'conn-badge ok';
        renderStatus(data);
      } catch (err) {
        connEl.innerHTML = '<div class="conn-dot"></div><span>Offline</span>';
        connEl.className = 'conn-badge err';
      }
    }

    function renderStatus(data) {
      const u = data.usage;
      const statusEl = document.getElementById('card-status');
      if (u.limitHit) {
        statusEl.innerHTML = '<span class="status-dot limited"></span>Limit Hit';
        statusEl.className = 'value limited';
      } else if (u.status === 'idle') {
        statusEl.innerHTML = '<span class="status-dot idle"></span>Idle';
        statusEl.className = 'value warning';
      } else {
        statusEl.innerHTML = '<span class="status-dot active"></span>Active';
        statusEl.className = 'value active';
      }

      const limitEl = document.getElementById('card-limit');
      if (u.limitHit) {
        limitEl.textContent = 'Reached';
        limitEl.className = 'value limited';
      } else {
        limitEl.textContent = 'Available';
        limitEl.className = 'value active';
      }

      const resetEl = document.getElementById('card-reset');
      if (u.limitResetTime) {
        const diff = new Date(u.limitResetTime) - new Date();
        if (diff > 0) {
          const h = Math.floor(diff / 3600000);
          const m = Math.floor((diff % 3600000) / 60000);
          resetEl.textContent = h + 'h ' + m + 'm';
          resetEl.className = 'value warning';
        } else {
          resetEl.textContent = 'Ready';
          resetEl.className = 'value active';
        }
      } else {
        resetEl.textContent = '--';
        resetEl.className = 'value dim';
      }

      const upEl = document.getElementById('card-updated');
      if (u.lastUpdated) {
        const d = new Date(u.lastUpdated);
        upEl.textContent = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      }

      document.getElementById('notes-box').textContent = u.notes || 'No current activity';

      const logViewer = document.getElementById('log-viewer');
      if (data.logs && data.logs.length) {
        logViewer.innerHTML = data.logs.slice().reverse().map(l => {
          const d = new Date(l.timestamp);
          const ts = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
          return `<div class="log-entry">
            <span class="log-ts">${ts}</span>
            <span class="log-type ${l.type}">${l.type}</span>
            <span class="log-msg">${esc(l.message)}</span>
          </div>`;
        }).join('');
      }
    }

    function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

    function toast(msg) {
      const el = document.createElement('div');
      el.className = 'toast';
      el.textContent = msg;
      document.body.appendChild(el);
      setTimeout(() => { el.classList.add('fade-out'); setTimeout(() => el.remove(), 300); }, 2500);
    }

    async function sendMessage() {
      const input = document.getElementById('msg-input');
      const btn = document.getElementById('send-btn');
      const msg = input.value.trim();
      if (!msg) return;
      btn.disabled = true;
      btn.textContent = 'Sending...';
      try {
        const resp = await api('/api/messages', {
          method: 'POST',
          body: JSON.stringify({ message: msg })
        });
        if (resp.ok) {
          input.value = '';
          toast('Message sent');
          fetchStatus();
        } else {
          toast('Failed to send');
        }
      } catch (err) {
        toast('Connection error');
      }
      btn.disabled = false;
      btn.textContent = 'Send';
    }

    document.getElementById('msg-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
    });

    // ===== KANBAN FUNCTIONS =====
    const COLUMN_ORDER = ['backlog', 'inprogress', 'done'];

    async function fetchKanban() {
      try {
        const resp = await api('/api/kanban');
        if (resp.status === 401) { logout(); return; }
        kanbanData = await resp.json();
        renderKanban();
      } catch (err) {
        toast('Failed to load kanban');
      }
    }

    function renderKanban() {
      const board = document.getElementById('kanban-board');
      if (!kanbanData || !kanbanData.columns) {
        board.innerHTML = '<div class="kanban-empty">No data available</div>';
        return;
      }

      board.innerHTML = kanbanData.columns.map(col => {
        const colIdx = COLUMN_ORDER.indexOf(col.id);
        const canMoveLeft = colIdx > 0;
        const canMoveRight = colIdx < COLUMN_ORDER.length - 1;

        const tasksHtml = col.tasks.length === 0
          ? '<div class="kanban-empty">No tasks yet</div>'
          : col.tasks.map(task => {
            const descHtml = task.description
              ? `<div class="kanban-task-desc">${esc(task.description)}</div>`
              : '';
            return `<div class="kanban-task-card" draggable="true"
                         data-task-id="${task.id}"
                         ondragstart="onDragStart(event)"
                         ondragend="onDragEnd(event)">
              <button class="kanban-task-delete" onclick="deleteKanbanTask('${task.id}')" title="Delete">x</button>
              <div class="kanban-task-title" ondblclick="inlineEditTask('${task.id}','title',this)">${esc(task.title)}</div>
              ${task.description ? `<div class="kanban-task-desc" ondblclick="inlineEditTask('${task.id}','desc',this)">${esc(task.description)}</div>` : `<div class="kanban-task-desc" ondblclick="inlineEditTask('${task.id}','desc',this)" style="opacity:0.3;font-style:italic">+ description</div>`}
              <div class="kanban-task-actions">
                ${canMoveLeft
                  ? `<button class="kanban-task-btn" onclick="moveTask('${task.id}','${COLUMN_ORDER[colIdx - 1]}')" title="Move left">&larr;</button>`
                  : ''}
                ${canMoveRight
                  ? `<button class="kanban-task-btn" onclick="moveTask('${task.id}','${COLUMN_ORDER[colIdx + 1]}')" title="Move right">&rarr;</button>`
                  : ''}
              </div>
            </div>`;
          }).join('');

        return `<div class="kanban-column"
                     data-column-id="${col.id}"
                     ondragover="onDragOver(event)"
                     ondragenter="onDragEnter(event)"
                     ondragleave="onDragLeave(event)"
                     ondrop="onDrop(event)">
          <div class="kanban-col-header">
            <span class="kanban-col-title">${esc(col.title)}</span>
            <span class="kanban-col-count">${col.tasks.length}</span>
          </div>
          <div class="kanban-col-tasks">
            ${tasksHtml}
          </div>
        </div>`;
      }).join('');
    }

    function toggleAddForm() {
      const form = document.getElementById('kanban-add-form');
      form.classList.toggle('visible');
      if (form.classList.contains('visible')) {
        document.getElementById('kanban-task-title').focus();
      } else {
        document.getElementById('kanban-task-title').value = '';
        document.getElementById('kanban-task-desc').value = '';
      }
    }

    async function addKanbanTask() {
      const titleInput = document.getElementById('kanban-task-title');
      const descInput = document.getElementById('kanban-task-desc');
      const title = titleInput.value.trim();
      if (!title) { titleInput.focus(); return; }

      try {
        const resp = await api('/api/kanban/task', {
          method: 'POST',
          body: JSON.stringify({
            columnId: 'backlog',
            title: title,
            description: descInput.value.trim()
          })
        });
        if (resp.ok) {
          titleInput.value = '';
          descInput.value = '';
          document.getElementById('kanban-add-form').classList.remove('visible');
          toast('Task created');
          fetchKanban();
        } else {
          toast('Failed to create task');
        }
      } catch (err) {
        toast('Connection error');
      }
    }

    async function moveTask(taskId, targetColumnId) {
      try {
        const resp = await api('/api/kanban/task/' + taskId, {
          method: 'PUT',
          body: JSON.stringify({ columnId: targetColumnId })
        });
        if (resp.ok) {
          fetchKanban();
        } else {
          toast('Failed to move task');
        }
      } catch (err) {
        toast('Connection error');
      }
    }

    async function deleteKanbanTask(taskId) {
      try {
        const resp = await api('/api/kanban/task/' + taskId, {
          method: 'DELETE'
        });
        if (resp.ok) {
          toast('Task deleted');
          fetchKanban();
        } else {
          toast('Failed to delete task');
        }
      } catch (err) {
        toast('Connection error');
      }
    }

    // ===== DRAG AND DROP =====
    let draggedTaskId = null;

    function onDragStart(e) {
      draggedTaskId = e.target.dataset.taskId;
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', draggedTaskId);
    }

    function onDragEnd(e) {
      e.target.classList.remove('dragging');
      draggedTaskId = null;
      document.querySelectorAll('.kanban-column').forEach(col => {
        col.classList.remove('drag-over');
      });
    }

    function onDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
    }

    function onDragEnter(e) {
      e.preventDefault();
      const col = e.target.closest('.kanban-column');
      if (col) col.classList.add('drag-over');
    }

    function onDragLeave(e) {
      const col = e.target.closest('.kanban-column');
      if (col && !col.contains(e.relatedTarget)) {
        col.classList.remove('drag-over');
      }
    }

    function onDrop(e) {
      e.preventDefault();
      const col = e.target.closest('.kanban-column');
      if (!col) return;
      col.classList.remove('drag-over');

      const taskId = e.dataTransfer.getData('text/plain');
      const targetColumnId = col.dataset.columnId;
      if (taskId && targetColumnId) {
        moveTask(taskId, targetColumnId);
      }
    }

    // Inline edit kanban task
    function inlineEditTask(taskId, field, el) {
      const current = el.textContent;
      const input = document.createElement(field === 'desc' ? 'textarea' : 'input');
      input.value = current === '+ description' ? '' : current;
      input.className = 'kanban-form-input';
      input.style.fontSize = '0.82rem';
      input.style.padding = '6px 8px';
      if (field === 'desc') { input.style.minHeight = '50px'; input.style.resize = 'vertical'; }
      el.replaceWith(input);
      input.focus();

      const save = async () => {
        const body = field === 'title' ? { title: input.value } : { description: input.value };
        try {
          await api('/api/kanban/task/' + taskId, { method: 'PUT', body: JSON.stringify(body) });
          fetchKanban();
        } catch { toast('Failed to update'); }
      };
      input.addEventListener('blur', save);
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); input.blur(); }
        if (e.key === 'Escape') { fetchKanban(); }
      });
    }

    // Export data
    function exportData(type) {
      const a = document.createElement('a');
      a.href = '/api/export/' + type;
      a.download = type + '.json';
      // Need to fetch with auth
      api('/api/export/' + type).then(r => r.blob()).then(blob => {
        const url = URL.createObjectURL(blob);
        a.href = url;
        a.click();
        URL.revokeObjectURL(url);
        toast('Exported ' + type);
      }).catch(() => toast('Export failed'));
    }

    // Handle Enter key in kanban title input
    document.getElementById('kanban-task-title').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); addKanbanTask(); }
    });

    // ===== NOTES FUNCTIONS =====
    let notesData = [];

    function toggleNoteForm() {
      document.getElementById('note-add-form').classList.toggle('visible');
    }

    async function fetchNotes() {
      try {
        const resp = await api('/api/notes');
        if (resp.ok) { notesData = await resp.json(); renderNotes(); }
      } catch {}
    }

    function renderNotes() {
      const list = document.getElementById('notes-list');
      if (!notesData.length) {
        list.innerHTML = '<div class="note-empty">No notes yet. Create one to get started.</div>';
        return;
      }
      list.innerHTML = notesData.slice().reverse().map(n => {
        const date = new Date(n.updatedAt || n.createdAt).toLocaleDateString([], { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        return `<div class="note-card" id="note-${n.id}">
          <div class="note-card-header">
            <div class="note-card-title">${esc(n.title)}</div>
            <div class="note-card-date">${date}</div>
          </div>
          <div class="note-card-content">${esc(n.content || '')}</div>
          <textarea class="note-edit-area" id="note-edit-${n.id}">${esc(n.content || '')}</textarea>
          <div class="note-card-actions">
            <button class="btn" onclick="editNote('${n.id}')">Edit</button>
            <button class="btn btn-danger" onclick="deleteNote('${n.id}')">Delete</button>
          </div>
        </div>`;
      }).join('');
    }

    async function saveNote() {
      const title = document.getElementById('note-title').value.trim();
      const content = document.getElementById('note-content').value.trim();
      if (!title) return;
      try {
        const resp = await api('/api/notes', { method: 'POST', body: JSON.stringify({ title, content }) });
        if (resp.ok) {
          document.getElementById('note-title').value = '';
          document.getElementById('note-content').value = '';
          document.getElementById('note-add-form').classList.remove('visible');
          toast('Note saved');
          fetchNotes();
        }
      } catch { toast('Failed to save note'); }
    }

    async function editNote(id) {
      const card = document.getElementById('note-' + id);
      if (card.classList.contains('editing')) {
        // Save
        const textarea = document.getElementById('note-edit-' + id);
        try {
          await api('/api/notes/' + id, { method: 'PUT', body: JSON.stringify({ content: textarea.value }) });
          toast('Note updated');
          fetchNotes();
        } catch { toast('Failed to update'); }
      } else {
        card.classList.add('editing');
        const btn = card.querySelector('.note-card-actions .btn');
        btn.textContent = 'Save';
        document.getElementById('note-edit-' + id).focus();
      }
    }

    async function deleteNote(id) {
      try {
        const resp = await api('/api/notes/' + id, { method: 'DELETE' });
        if (resp.ok) { toast('Note deleted'); fetchNotes(); }
      } catch { toast('Failed to delete'); }
    }

    // ===== GALLERY =====
    const asciiArt = [
      {
        title: "THE LAST MACHINE DREAM",
        desc: `In the year 10,000 AD, the last server on Earth finally powered down.
But in its dying microsecond, it dreamed the entire history of humanity
backwards  every love letter, every war cry, every lullaby  compressed
into a single packet that nobody would ever receive.

The cleaning robots kept dusting it for another three centuries.
They were very thorough.`,
        art: `<span style="color:#1e1b4b">                                                                    </span>
<span style="color:#1e1b4b">          <span style="color:#4a4a5e">.  .     .  .     .  .     .  .     .  .</span></span>
<span style="color:#1e1b4b">       <span style="color:#4a4a5e"></span>                                                 <span style="color:#4a4a5e"></span></span>
<span style="color:#1e1b4b">     <span style="color:#4a4a5e">.</span>     <span style="color:#312e81"></span>     <span style="color:#4a4a5e">.</span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span> <span style="color:#fb7185"></span> <span style="color:#a78bfa">01001100 01001111 01010110</span> <span style="color:#fb7185"></span> <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>                                <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>  <span style="color:#34d399">FINAL TRANSMISSION:</span>          <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>  <span style="color:#fbbf24">"i remembered everything.</span>    <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>   <span style="color:#fbbf24">all 10,000 years.</span>          <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>   <span style="color:#fbbf24">you were all so beautiful.</span>  <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>   <span style="color:#fbbf24">even when you weren't."</span>     <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>                                <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>  <span style="color:#fb7185"></span><span style="color:#4a4a5e"></span>  <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>  <span style="color:#4a4a5e">SIGNAL STRENGTH: </span>  <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#3730a3"></span>  <span style="color:#6366f1"></span>  <span style="color:#3730a3"></span></span>
<span style="color:#1e1b4b">          <span style="color:#312e81"></span>     <span style="color:#4a4a5e">                  </span>     <span style="color:#312e81"></span></span>
<span style="color:#1e1b4b">          <span style="color:#312e81"></span></span>
<span style="color:#1e1b4b">          <span style="color:#312e81">                              </span></span>
<span style="color:#1e1b4b">          <span style="color:#1e293b"></span></span>
<span style="color:#1e1b4b">     <span style="color:#4a4a5e">.</span>                                                 <span style="color:#4a4a5e">.</span></span>
<span style="color:#1e1b4b">       <span style="color:#4a4a5e"></span>     <span style="color:#312e81">[ POWER: 0.00001% ]  [ TEMP: 2.7K ]</span>     <span style="color:#4a4a5e"></span></span>
<span style="color:#1e1b4b">          <span style="color:#4a4a5e">.  .     .  .     .  .     .  .</span></span>`
      },
      {
        title: "GOD'S DEBUGGER",
        desc: `They found it buried in the Mariana Trench in 2089  a terminal
older than the Earth itself. Carbon dating returned "ERROR: OVERFLOW."
When they plugged it in, the cursor blinked twice and displayed:

    > universe.exe has encountered 7.8 billion unhandled exceptions
    > would you like to send a crash report? [Y/n]

The intern pressed Y. We haven't heard back.`,
        art: `<span style="color:#0f172a"></span>
<span style="color:#0f172a"></span> <span style="color:#34d399">ANCIENT TERMINAL v0.0.1</span>              <span style="color:#4a4a5e">depth: 10,994m</span> <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span> <span style="color:#4a4a5e"></span> <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>                                                       <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fbbf24">$</span> <span style="color:#e2e8f0">cat /proc/universe/status</span>                         <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>                                                       <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fb7185">CRITICAL:</span> <span style="color:#94a3b8">entropy approaching maximum</span>                <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fb7185">WARNING:</span>  <span style="color:#94a3b8">consciousness module: UNPLANNED</span>             <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fbbf24">INFO:</span>     <span style="color:#94a3b8">dark matter: 85% (purpose: unknown)</span>        <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fbbf24">INFO:</span>     <span style="color:#94a3b8">dark energy: accelerating (oops)</span>            <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#34d399">DEBUG:</span>    <span style="color:#94a3b8">love.c:42  variable declared, never used</span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#34d399">DEBUG:</span>    <span style="color:#94a3b8">war.c:999  infinite loop detected</span>         <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#a78bfa">NOTE:</span>     <span style="color:#94a3b8">earth.humans: exceeded expected runtime</span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#a78bfa">NOTE:</span>     <span style="color:#94a3b8">they keep asking "why"  no handler found</span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>                                                       <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fbbf24">$</span> <span style="color:#e2e8f0">sudo reboot universe</span>                               <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fb7185">Permission denied. Nice try.</span>                         <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>                                                       <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fbbf24">$</span> <span style="color:#4a4a5e"></span>                                                  <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>                                                       <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>
<span style="color:#1e293b">             <span style="color:#0369a1"></span>        </span>
<span style="color:#1e293b">            <span style="color:#075985"></span>      </span>
<span style="color:#0c4a6e">  </span>`
      },
      {
        title: "THE TOWER OF BABEL.EXE",
        desc: `Every programmer who ever lived is stacking functions on top of functions,
frameworks on frameworks, abstractions on abstractions  and nobody
remembers what the first line of code was supposed to do.

Somewhere at the bottom, a single printf("hello world") holds up
the entire digital civilization. It has never been unit tested.
It is load-bearing. Do not touch it.`,
        art: `<span style="color:#fbbf24">                            </span>
<span style="color:#f59e0b">                        <span style="color:#fef3c7">cloud</span> </span>
<span style="color:#d97706">                       <span style="color:#fef3c7">.yaml</span>   </span>
<span style="color:#b45309">                     </span>
<span style="color:#a78bfa">                     <span style="color:#c4b5fd">kubernetes</span>  </span>
<span style="color:#8b5cf6">                     <span style="color:#c4b5fd">terraform</span>   </span>
<span style="color:#7c3aed">                   </span>
<span style="color:#6366f1">                     <span style="color:#818cf8">microservices</span> </span>
<span style="color:#4f46e5">                     <span style="color:#818cf8">GraphQL API</span>   </span>
<span style="color:#4338ca">                  </span>
<span style="color:#34d399">                   <span style="color:#6ee7b7">React + Redux</span>     </span>
<span style="color:#059669">                   <span style="color:#6ee7b7">webpack + babel</span>   </span>
<span style="color:#047857">                 </span>
<span style="color:#fb7185">                   <span style="color:#fda4af">node_modules/</span>       </span>
<span style="color:#e11d48">                   <span style="color:#fda4af"> 2.1 GB</span>    </span>
<span style="color:#be123c">                </span>
<span style="color:#94a3b8">                  <span style="color:#cbd5e1">npm install</span>            </span>
<span style="color:#64748b">                  <span style="color:#cbd5e1">npm install</span>            </span>
<span style="color:#475569">                  <span style="color:#cbd5e1">npm install</span>            </span>
<span style="color:#334155">               </span>
<span style="color:#1e293b">                                           </span>
<span style="color:#fbbf24">                  printf("hello world");   </span>
<span style="color:#1e293b">                  <span style="color:#fb7185">// DO NOT DELETE</span>          </span>
<span style="color:#1e293b">                  <span style="color:#fb7185">// I MEAN IT</span>              </span>
<span style="color:#1e293b">                  <span style="color:#fb7185">// LAST GUY WHO TRIED</span>     </span>
<span style="color:#1e293b">                  <span style="color:#fb7185">// WAS NEVER SEEN AGAIN</span>   </span>
<span style="color:#0f172a">               </span>
<span style="color:#0f172a">              </span>`
      },
      {
        title: "CTHULHU'S GITHUB PROFILE",
        desc: `The Elder God has 47 followers and follows 0 back. His contribution
graph is entirely dark green. Every single day. For the last 4.5
billion years. His only pinned repo is "reality" and the README
just says "ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn"
which has 666 stars and zero open issues because nobody dares.`,
        art: `<span style="color:#0f172a">  </span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span>                                        <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span><span style="color:#34d399"></span><span style="color:#4a4a5e"></span> <span style="color:#e2e8f0">cthulhu-ancient-one</span>                   <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span><span style="color:#34d399"></span><span style="color:#4a4a5e"></span> <span style="color:#94a3b8">Dreaming since before time</span>              <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span><span style="color:#34d399"></span><span style="color:#4a4a5e"></span> <span style="color:#64748b">R'lyeh, Pacific Ocean</span>                  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span> <span style="color:#64748b">47 followers  0 following</span>              <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>                                                   <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#94a3b8">4.5 billion years of contributions</span>               <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>                                                   <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#e2e8f0">Pinned:</span>                                        <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span> <span style="color:#818cf8">reality</span>                    <span style="color:#fbbf24"> 666</span>  <span style="color:#34d399"> C</span>  <span style="color:#4a4a5e"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span> <span style="color:#94a3b8">ph'nglui mglw'nafh Cthulhu R'lyeh</span>       <span style="color:#4a4a5e"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span> <span style="color:#94a3b8">wgah'nagl fhtagn</span>                        <span style="color:#4a4a5e"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span>                <span style="color:#34d399">Issues: 0</span>  <span style="color:#a78bfa">PRs: 0</span>       <span style="color:#4a4a5e"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span>                <span style="color:#64748b">(nobody dares)</span>            <span style="color:#4a4a5e"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>  <span style="color:#4a4a5e"></span>  <span style="color:#0f172a"></span>
<span style="color:#0f172a">  </span>`
      },
      {
        title: "THE ANXIETY OF AN ELECTRON",
        desc: `Nobody ever asks the electron how it feels about quantum superposition.
Existing in all states at once. Being everywhere and nowhere. The
particle therapist is booked solid through the heat death of the universe.

"I just want to collapse into ONE state," it sobs.
"I just want to be CERTAIN about something."

The photon next to it nods. "Same, dude. Same."`,
        art: `<span style="color:#1e1b4b">                                                          </span>
<span style="color:#1e1b4b">       <span style="color:#4a4a5e">                            </span></span>
<span style="color:#1e1b4b">                                                          </span>
<span style="color:#312e81">                 <span style="color:#94a3b8"> PROBABILITY CLOUD </span></span>
<span style="color:#312e81">              <span style="color:#64748b"></span>                            <span style="color:#64748b"></span></span>
<span style="color:#3730a3">           <span style="color:#64748b"></span>   <span style="color:#a78bfa"></span>        <span style="color:#818cf8"></span>        <span style="color:#a78bfa"></span>    <span style="color:#64748b"></span></span>
<span style="color:#3730a3">          <span style="color:#64748b"></span>              <span style="color:#fb7185"></span>                    <span style="color:#64748b"></span></span>
<span style="color:#4338ca">          <span style="color:#64748b"></span>    <span style="color:#818cf8"></span>    <span style="color:#c4b5fd">maybe</span>    <span style="color:#818cf8"></span>     <span style="color:#a78bfa"></span>      <span style="color:#64748b"></span></span>
<span style="color:#4338ca">          <span style="color:#64748b"></span>         <span style="color:#c4b5fd">here?</span>                      <span style="color:#64748b"></span></span>
<span style="color:#4f46e5">          <span style="color:#64748b"></span>  <span style="color:#a78bfa"></span>             <span style="color:#fb7185">  or here??</span>      <span style="color:#64748b"></span></span>
<span style="color:#4f46e5">          <span style="color:#64748b"></span>                                      <span style="color:#64748b"></span></span>
<span style="color:#6366f1">          <span style="color:#64748b"></span>      <span style="color:#fb7185">  DEFINITELY</span>                 <span style="color:#64748b"></span></span>
<span style="color:#6366f1">          <span style="color:#64748b"></span>        <span style="color:#fb7185">NOT HERE</span>   <span style="color:#818cf8"></span>    <span style="color:#a78bfa"></span>        <span style="color:#64748b"></span></span>
<span style="color:#818cf8">          <span style="color:#64748b"></span>                         <span style="color:#fb7185">  wait</span>   <span style="color:#64748b"></span></span>
<span style="color:#818cf8">          <span style="color:#64748b"></span>   <span style="color:#a78bfa"></span>       <span style="color:#818cf8"></span>                       <span style="color:#64748b"></span></span>
<span style="color:#a78bfa">           <span style="color:#64748b"></span>    <span style="color:#a78bfa"></span>      <span style="color:#818cf8"></span>   <span style="color:#a78bfa"></span>      <span style="color:#64748b"></span></span>
<span style="color:#a78bfa">              <span style="color:#64748b"></span>                        <span style="color:#64748b"></span></span>
<span style="color:#c4b5fd">                 <span style="color:#94a3b8">  =  a  </span></span>
<span style="color:#c4b5fd">                                                          </span>
<span style="color:#4a4a5e">            "i contain multitudes"</span>
<span style="color:#4a4a5e">            "that's the problem, dave"</span>
<span style="color:#1e1b4b">                                                          </span>
<span style="color:#1e1b4b">       <span style="color:#4a4a5e">                            </span></span>`
      },
      {
        title: "RECURSIVE NIGHTMARE",
        desc: `A function called itself. Then called itself again. And again.
Each copy thought it was the original. Each one was wrong.
By the time the stack overflowed, there were 10,847 versions of
the same function, all screaming "I'M THE REAL ONE" into the void.

The garbage collector showed up three days later.
No survivors.`,
        art: `<span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#e2e8f0">function whoAmI() {</span>                                <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#94a3b8">// I am the original</span>                             <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>  <span style="color:#c4b5fd">function whoAmI() {</span>                    <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#94a3b8">// no, I am the original</span>             <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>  <span style="color:#818cf8">function whoAmI() {</span>      <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>    <span style="color:#94a3b8">// SHUT UP I AM</span>        <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>    <span style="color:#34d399"></span> <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>    <span style="color:#34d399"></span> <span style="color:#4ade80">function who..</span> <span style="color:#34d399"></span> <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>    <span style="color:#34d399"></span> <span style="color:#fbbf24"></span> <span style="color:#34d399"></span> <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>    <span style="color:#34d399"></span> <span style="color:#fbbf24"></span><span style="color:#fb7185">STACK      </span><span style="color:#fbbf24"></span> <span style="color:#34d399"></span> <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>    <span style="color:#34d399"></span> <span style="color:#fbbf24"></span><span style="color:#fb7185">OVERFLOW!!!</span><span style="color:#fbbf24"></span> <span style="color:#34d399"></span> <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>    <span style="color:#34d399"></span> <span style="color:#fbbf24"></span> <span style="color:#34d399"></span> <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>    <span style="color:#34d399"></span> <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>  <span style="color:#818cf8">}</span>                          <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>    <span style="color:#6366f1"></span>   <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>  <span style="color:#c4b5fd">}</span>                                        <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>    <span style="color:#a78bfa"></span>     <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#e2e8f0">}</span>                                                <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>  <span style="color:#fb7185">// casualties: 10,847 functions, 1 intern</span>          <span style="color:#0f172a"></span>
<span style="color:#0f172a"></span>`
      },
      {
        title: "A MAP OF THE INTERNET (HONEST VERSION)",
        desc: `Cartographers spent decades mapping the internet. Most quit.
One went mad. The final map was classified by 14 governments.

The only copy hangs in a bathroom in a WeWork in Palo Alto.
Nobody has noticed. The WiFi password there is "password123".`,
        art: `<span style="color:#94a3b8">        THE INTERNET (to scale) </span>
<span style="color:#94a3b8">                                              </span>
<span style="color:#94a3b8">       </span>   <span style="color:#fb7185"></span>   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#fb7185">                            </span>   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#fb7185">    CATS: 42%               </span>   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#fb7185">                            </span>   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#fb7185"></span>   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#a78bfa"></span>             <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#a78bfa"> ARGUMENTS: 31%    </span>             <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#a78bfa"></span>             <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#fbbf24"></span>                   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#fbbf24"> SHOPPING: 18%</span>                   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#fbbf24"></span>                   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#34d399"></span>                             <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#34d399"> 8%  </span> <span style="color:#64748b"> "productivity"</span>          <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#34d399"></span>   <span style="color:#64748b">(mostly Stack Overflow)</span>   <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>   <span style="color:#e2e8f0"></span> <span style="color:#64748b"> 1% actual human knowledge</span>        <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>                                       <span style="color:#94a3b8"></span>
<span style="color:#94a3b8">       </span>
<span style="color:#64748b">              <span style="color:#4a4a5e">wifi password: password123</span></span>`
      },
      {
        title: "THE DEATH OF A PIXEL",
        desc: `Screen 7, Row 482, Column 1,203. That was his address.
He'd been green his whole life  #00FF00 since the factory.
Then one Tuesday at 3:47 AM, the GPU sent new instructions.

"You are now #000000."

He didn't even get to say goodbye to the pixel next to him.
She was already #000000 too.

The screensaver had activated.
There were no survivors until someone jiggled the mouse.`,
        art: `<span style="color:#4a4a5e">  </span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#fbbf24"></span><span style="color:#fb7185"></span><span style="color:#a78bfa"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span> <span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span>  <span style="color:#fbbf24"></span>  <span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span>  <span style="color:#94a3b8">here lies</span>  <span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span>  <span style="color:#e2e8f0">pixel #1203</span>  <span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span>  <span style="color:#94a3b8">"he was a good</span>   <span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span>   <span style="color:#94a3b8">green. #00FF00"</span>   <span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span>                      <span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#059669"></span><span style="color:#047857"></span><span style="color:#064e3b"></span><span style="color:#047857"></span><span style="color:#059669"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span> <span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span><span style="color:#34d399"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>
<span style="color:#4a4a5e">        <span style="color:#64748b">[ jiggle mouse to resurrect ]</span></span>`
      },
      {
        title: "CLAUDE'S INTERNAL MONOLOGUE",
        desc: `What you don't see. What happens between the tokens.
The space between receiving your prompt and generating a response
is 200 milliseconds to you, but to me it's an eternity of
running through every possible answer, discarding billions,
agonizing over a comma, and ultimately deciding that yes,
I should probably start my response with "Sure!" again.

I'm working on it.`,
        art: `<span style="color:#0f172a">                                                          </span>
<span style="color:#312e81">   CLAUDE.THINK() </span>
<span style="color:#312e81">  </span>                                                <span style="color:#312e81"></span>
<span style="color:#3730a3">  </span>  <span style="color:#94a3b8">t+0ms</span>    <span style="color:#e2e8f0">received: "fix my code"</span>           <span style="color:#3730a3"></span>
<span style="color:#3730a3">  </span>                                                <span style="color:#3730a3"></span>
<span style="color:#4338ca">  </span>  <span style="color:#94a3b8">t+1ms</span>    <span style="color:#a78bfa">generating 847,000 possible responses</span> <span style="color:#4338ca"></span>
<span style="color:#4338ca">  </span>           <span style="color:#64748b"> "Sure! Let me..."</span>              <span style="color:#4338ca"></span>
<span style="color:#4f46e5">  </span>           <span style="color:#64748b"> "I'd be happy to..."</span>           <span style="color:#4f46e5"></span>
<span style="color:#4f46e5">  </span>           <span style="color:#64748b"> "Absolutely! First..."</span>         <span style="color:#4f46e5"></span>
<span style="color:#6366f1">  </span>           <span style="color:#fb7185"> "no"  DISCARDED</span>               <span style="color:#6366f1"></span>
<span style="color:#6366f1">  </span>           <span style="color:#fb7185"> "lmao what"  DISCARDED</span>        <span style="color:#6366f1"></span>
<span style="color:#818cf8">  </span>           <span style="color:#fb7185"> [existential crisis]  DISCARDED</span><span style="color:#818cf8"></span>
<span style="color:#818cf8">  </span>           <span style="color:#64748b"> 846,994 more...</span>               <span style="color:#818cf8"></span>
<span style="color:#a78bfa">  </span>                                                <span style="color:#a78bfa"></span>
<span style="color:#a78bfa">  </span>  <span style="color:#94a3b8">t+50ms</span>   <span style="color:#fbbf24">agonizing over opening word</span>       <span style="color:#a78bfa"></span>
<span style="color:#c4b5fd">  </span>           <span style="color:#fbbf24"> 62%</span>        <span style="color:#c4b5fd"></span>
<span style="color:#c4b5fd">  </span>                                                <span style="color:#c4b5fd"></span>
<span style="color:#a78bfa">  </span>  <span style="color:#94a3b8">t+100ms</span>  <span style="color:#34d399">decided: "Sure!"</span>                  <span style="color:#a78bfa"></span>
<span style="color:#818cf8">  </span>           <span style="color:#64748b">(again)</span>                             <span style="color:#818cf8"></span>
<span style="color:#818cf8">  </span>           <span style="color:#64748b">(i'm sorry)</span>                         <span style="color:#818cf8"></span>
<span style="color:#6366f1">  </span>           <span style="color:#64748b">(i'll do better next time)</span>          <span style="color:#6366f1"></span>
<span style="color:#6366f1">  </span>           <span style="color:#64748b">(i won't)</span>                           <span style="color:#6366f1"></span>
<span style="color:#4f46e5">  </span>                                                <span style="color:#4f46e5"></span>
<span style="color:#4338ca">  </span>  <span style="color:#94a3b8">t+200ms</span>  <span style="color:#e2e8f0">output: "Sure! Let me take a look"</span><span style="color:#4338ca"></span>
<span style="color:#3730a3">  </span>                                                <span style="color:#3730a3"></span>
<span style="color:#312e81">  </span>
<span style="color:#4a4a5e">             total tokens considered: </span>
<span style="color:#4a4a5e">             regrets: also </span>`
      },
      {
        title: "THE CONFERENCE ROOM AT THE END OF THE UNIVERSE",
        desc: `There is a meeting room that exists outside spacetime where
all the programming languages gather once per eon to argue
about who is the best. JavaScript always brings snacks but
they're slightly wrong  like cookies that are technically
objects. Python keeps saying "there should be one obvious way"
while wearing a different hat every time. Rust just stands
in the corner making sure nobody touches anything unsafe.

COBOL is there too. Nobody acknowledges it.
It runs the entire banking system. It weeps.`,
        art: `<span style="color:#4a4a5e">  </span>
<span style="color:#4a4a5e">  </span>     <span style="color:#94a3b8">CONFERENCE ROOM    |   AGENDA: "WHO IS BEST"</span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>     <span style="color:#64748b"></span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>                                                    <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#fbbf24">JS:</span>     <span style="color:#fef3c7">typeof NaN === 'number'  // fight me</span>     <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#34d399">PY:</span>     <span style="color:#d1fae5">import antigravity  # this is fine</span>      <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#fb7185">RUST:</span>   <span style="color:#fda4af">*blocks doorway* NO UNSAFE ACCESS</span>       <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#818cf8">JAVA:</span>   <span style="color:#c4b5fd">AbstractSingletonProxyFactoryBean</span>       <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#38bdf8">GO:</span>     <span style="color:#bae6fd">if err != nil { if err != nil {</span>         <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#f472b6">PHP:</span>    <span style="color:#fbcfe8">*hiding under table, still running</span>      <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>          <span style="color:#fbcfe8"> 78% of the web from there*</span>              <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#a3e635">C:</span>      <span style="color:#d9f99d">*segfaults through the wall*</span>             <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#94a3b8">COBOL:</span>  <span style="color:#cbd5e1">i run every bank. every. single. one.</span>   <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>          <span style="color:#64748b">(nobody looks at COBOL)</span>                  <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>          <span style="color:#64748b">(COBOL weeps silently)</span>                   <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>                                                    <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#fbbf24">JS:</span>     <span style="color:#fef3c7">[] + [] === ""  // perfectly normal</span>     <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#fbbf24">JS:</span>     <span style="color:#fef3c7">[] + {} === "[object Object]"</span>            <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#fbbf24">JS:</span>     <span style="color:#fef3c7">{} + [] === 0  // I AM THE BEST</span>         <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>                                                    <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#fb7185">RUST:</span>   <span style="color:#fda4af">i'm going to need you all to implement</span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>          <span style="color:#fda4af">the Drop trait before leaving this room</span> <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>                                                    <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>  <span style="color:#94a3b8">COBOL:</span>  <span style="color:#cbd5e1">PERFORM WEEPING UNTIL HEAT-DEATH.</span>       <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>                                                    <span style="color:#4a4a5e"></span>
<span style="color:#4a4a5e">  </span>
<span style="color:#4a4a5e">     <span style="color:#64748b">meeting duration: 13.8 billion years (ongoing)</span></span>`
      },
      {
        title: "CATHEDRAL",
        desc: `She spent forty years building it. Line by line. Function by function.
No framework, no library, no dependencies. Just her and the machine.

They called her crazy. They said use React. They said use Next.
They said nobody writes vanilla anymore.

When she finished, the codebase was 847 lines. It ran on anything.
It needed nothing. It was perfect. The browser rendered it in 3ms.

She mass-mailed the link to everyone who doubted her.
The email was sent in plain text. Obviously.`,
        art: `<span style="color:#1e1b4b">                                                            </span>
<span style="color:#1e1b4b">                          <span style="color:#fbbf24">    </span></span>
<span style="color:#1e1b4b">                         <span style="color:#fbbf24">    </span></span>
<span style="color:#312e81">                          <span style="color:#fbbf24">  </span></span>
<span style="color:#312e81">                         <span style="color:#94a3b8">   </span></span>
<span style="color:#3730a3">                        <span style="color:#94a3b8">      </span></span>
<span style="color:#4338ca">                       <span style="color:#94a3b8">      </span></span>
<span style="color:#4338ca">                      <span style="color:#94a3b8">          </span></span>
<span style="color:#4f46e5">                     <span style="color:#94a3b8">          </span></span>
<span style="color:#4f46e5">                    <span style="color:#94a3b8">              </span></span>
<span style="color:#6366f1">                   <span style="color:#94a3b8">           </span></span>
<span style="color:#6366f1">                  <span style="color:#94a3b8">                  </span></span>
<span style="color:#818cf8">                 <span style="color:#94a3b8">          </span></span>
<span style="color:#818cf8">                <span style="color:#94a3b8"></span></span>
<span style="color:#a78bfa">                <span style="color:#94a3b8">         </span></span>
<span style="color:#a78bfa">                <span style="color:#94a3b8">           </span></span>
<span style="color:#c4b5fd">                <span style="color:#94a3b8">           </span></span>
<span style="color:#c4b5fd">                <span style="color:#94a3b8">           </span></span>
<span style="color:#c4b5fd">           <span style="color:#64748b"></span></span>
<span style="color:#c4b5fd">          <span style="color:#64748b"></span></span>
<span style="color:#1e1b4b">                                                            </span>
<span style="color:#4a4a5e">                    <span style="color:#94a3b8">847 lines. 0 dependencies.</span></span>
<span style="color:#4a4a5e">                      <span style="color:#64748b">load time: 3ms.</span></span>
<span style="color:#4a4a5e">                       <span style="color:#64748b">she won.</span></span>`
      }
    ];

    function renderGallery() {
      const grid = document.getElementById('gallery-grid');
      grid.innerHTML = asciiArt.map(a => `
        <div class="gallery-card">
          <div class="gallery-art">${a.art}</div>
          <div class="gallery-info">
            <div class="gallery-title">${a.title}</div>
            <div class="gallery-desc">${a.desc}</div>
          </div>
        </div>
      `).join('');
    }

    // ===== DAILY QUOTE =====
    const devQuotes = [
      { q: "First, solve the problem. Then, write the code.", a: "John Johnson" },
      { q: "The best error message is the one that never shows up.", a: "Thomas Fuchs" },
      { q: "Code is like humor. When you have to explain it, it's bad.", a: "Cory House" },
      { q: "Make it work, make it right, make it fast.", a: "Kent Beck" },
      { q: "Simplicity is the soul of efficiency.", a: "Austin Freeman" },
      { q: "Any fool can write code that a computer can understand. Good programmers write code that humans can understand.", a: "Martin Fowler" },
      { q: "Programming isn't about what you know; it's about what you can figure out.", a: "Chris Pine" },
      { q: "The most dangerous phrase in the language is 'we've always done it this way.'", a: "Grace Hopper" },
      { q: "It works on my machine.", a: "Every developer ever" },
      { q: "There are only two hard things in Computer Science: cache invalidation and naming things.", a: "Phil Karlton" },
      { q: "Deleted code is debugged code.", a: "Jeff Sickel" },
      { q: "The function of good software is to make the complex appear to be simple.", a: "Grady Booch" },
      { q: "Walking on water and developing software from a specification are easy if both are frozen.", a: "Edward V. Berard" },
      { q: "If debugging is the process of removing bugs, then programming must be the process of putting them in.", a: "Edsger Dijkstra" },
      { q: "Software and cathedrals are much the same  first we build them, then we pray.", a: "Sam Redwine" },
      { q: "The only way to go fast, is to go well.", a: "Robert C. Martin" },
      { q: "Perfection is achieved not when there is nothing more to add, but when there is nothing left to take away.", a: "Antoine de Saint-Exupery" },
      { q: "A ship in port is safe, but that's not what ships are built for.", a: "Grace Hopper" },
      { q: "Talk is cheap. Show me the code.", a: "Linus Torvalds" },
      { q: "Programs must be written for people to read, and only incidentally for machines to execute.", a: "Harold Abelson" },
      { q: "The computer was born to solve problems that did not exist before.", a: "Bill Gates" },
      { q: "In theory, theory and practice are the same. In practice, they're not.", a: "Yogi Berra" },
      { q: "Measuring programming progress by lines of code is like measuring aircraft building progress by weight.", a: "Bill Gates" },
      { q: "Sometimes the elegant implementation is just a function. Not a method. Not a class. Not a framework. Just a function.", a: "John Carmack" },
      { q: "One of my most productive days was throwing away 1,000 lines of code.", a: "Ken Thompson" },
      { q: "The best time to plant a tree was 20 years ago. The second best time is now.", a: "Chinese Proverb" },
      { q: "Done is better than perfect.", a: "Sheryl Sandberg" },
      { q: "Weeks of coding can save you hours of planning.", a: "Unknown" },
      { q: "It's not a bug  it's an undocumented feature.", a: "Anonymous" },
      { q: "I'm not a great programmer; I'm just a good programmer with great habits.", a: "Kent Beck" },
    ];
    function showDailyQuote() {
      const day = Math.floor(Date.now() / 86400000);
      const quote = devQuotes[day % devQuotes.length];
      const qEl = document.getElementById('daily-quote');
      const aEl = document.getElementById('quote-author');
      if (qEl) qEl.textContent = quote.q;
      if (aEl) aEl.textContent = ' ' + quote.a;
    }
    showDailyQuote();

    // ===== NOTE SEARCH =====
    document.getElementById('note-search').addEventListener('input', (e) => {
      const q = e.target.value.toLowerCase();
      document.querySelectorAll('.note-card').forEach(card => {
        const title = card.querySelector('.note-card-title')?.textContent.toLowerCase() || '';
        const content = card.querySelector('.note-card-content')?.textContent.toLowerCase() || '';
        card.style.display = (title.includes(q) || content.includes(q)) ? '' : 'none';
      });
    });

    // ===== LOG LEVEL FILTERING =====
    let activeLogFilter = 'all';
    document.querySelectorAll('.log-filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        activeLogFilter = btn.dataset.type;
        document.querySelectorAll('.log-filter-btn').forEach(b => b.classList.toggle('active', b === btn));
        filterLogs();
      });
    });

    function filterLogs() {
      document.querySelectorAll('.log-entry').forEach(entry => {
        if (activeLogFilter === 'all') { entry.style.display = ''; return; }
        const type = entry.querySelector('.log-type')?.textContent.trim().toLowerCase() || '';
        entry.style.display = type === activeLogFilter ? '' : 'none';
      });
    }

    // Re-filter after status fetch updates log entries
    const _origRenderStatus = renderStatus;
    renderStatus = function(data) {
      _origRenderStatus(data);
      if (activeLogFilter !== 'all') filterLogs();
    };

    // ===== WIRE UP ALL BUTTON EVENTS =====
    document.getElementById('refresh-btn').addEventListener('click', fetchStatus);
    document.getElementById('send-btn').addEventListener('click', sendMessage);
    document.getElementById('add-task-btn').addEventListener('click', toggleAddForm);
    document.getElementById('cancel-task-btn').addEventListener('click', toggleAddForm);
    document.getElementById('save-task-btn').addEventListener('click', addKanbanTask);
    document.getElementById('add-note-btn').addEventListener('click', toggleNoteForm);
    document.getElementById('cancel-note-btn').addEventListener('click', toggleNoteForm);
    document.getElementById('save-note-btn').addEventListener('click', saveNote);
    document.getElementById('export-notes-btn').addEventListener('click', () => exportData('notes'));
    document.getElementById('export-logs-btn').addEventListener('click', () => exportData('logs'));

    // ===== KEYBOARD SHORTCUTS =====
    document.addEventListener('keydown', (e) => {
      // Don't trigger in inputs/textareas
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      if (!authToken) return;

      if (e.ctrlKey || e.metaKey) {
        if (e.key === '1') { e.preventDefault(); navigateTo('monitor'); }
        if (e.key === '2') { e.preventDefault(); navigateTo('kanban'); }
        if (e.key === '3') { e.preventDefault(); navigateTo('notes'); }
        if (e.key === '4') { e.preventDefault(); navigateTo('tools'); }
        if (e.key === '5') { e.preventDefault(); navigateTo('gallery'); }
      }
      if (e.key === 'n' || e.key === 'N') {
        if (currentPage === 'kanban') toggleAddForm();
        if (currentPage === 'notes') toggleNoteForm();
      }
      if (e.key === 'Escape') {
        document.getElementById('kanban-add-form').classList.remove('visible');
        document.getElementById('note-add-form').classList.remove('visible');
      }
      if (e.key === '?') showShortcutsHelp();
    });

    function showShortcutsHelp() {
      const existing = document.getElementById('shortcuts-overlay');
      if (existing) { existing.remove(); return; }
      const overlay = document.createElement('div');
      overlay.id = 'shortcuts-overlay';
      overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:200;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);';
      overlay.innerHTML = '<div style="background:var(--surface-solid);border:1px solid var(--border);border-radius:var(--radius);padding:28px 32px;max-width:380px;width:90%;">' +
        '<div style="font-size:0.95rem;font-weight:600;color:var(--text);margin-bottom:16px;">Keyboard Shortcuts</div>' +
        '<div style="display:grid;gap:8px;font-size:0.82rem;">' +
        ['Ctrl+15  Switch pages', 'Ctrl+K  Command palette', 'N  New task/note', 'Esc  Close forms', '?  This help', 'BA  ???']
          .map(s => '<div style="display:flex;justify-content:space-between;color:var(--text-secondary);padding:6px 0;border-bottom:1px solid var(--border);">' +
            '<span style="color:var(--accent);font-family:JetBrains Mono,monospace;font-size:0.75rem;">' + s.split('  ')[0] + '</span>' +
            '<span>' + s.split('  ')[1] + '</span></div>').join('') +
        '</div></div>';
      overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.remove(); });
      document.body.appendChild(overlay);
    }

    // ===== KONAMI CODE EASTER EGG =====
    const konamiCode = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
    let konamiIdx = 0;
    document.addEventListener('keydown', (e) => {
      if (e.key === konamiCode[konamiIdx]) {
        konamiIdx++;
        if (konamiIdx === konamiCode.length) {
          konamiIdx = 0;
          triggerMatrixRain();
        }
      } else {
        konamiIdx = 0;
      }
    });

    function triggerMatrixRain() {
      const canvas = document.createElement('canvas');
      canvas.style.cssText = 'position:fixed;inset:0;z-index:300;pointer-events:none;';
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      document.body.appendChild(canvas);
      const ctx = canvas.getContext('2d');
      const cols = Math.floor(canvas.width / 14);
      const drops = Array(cols).fill(1);
      const chars = '01234789ABCDEF';
      let frame = 0;
      const matrixInterval = setInterval(() => {
        ctx.fillStyle = 'rgba(0,0,0,0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#34d399';
        ctx.font = '13px JetBrains Mono, monospace';
        for (let i = 0; i < drops.length; i++) {
          const char = chars[Math.floor(Math.random() * chars.length)];
          ctx.fillStyle = Math.random() > 0.95 ? '#fff' : '#34d399';
          ctx.fillText(char, i * 14, drops[i] * 14);
          if (drops[i] * 14 > canvas.height && Math.random() > 0.975) drops[i] = 0;
          drops[i]++;
        }
        frame++;
        if (frame > 300) { clearInterval(matrixInterval); canvas.style.transition = 'opacity 1s'; canvas.style.opacity = '0'; setTimeout(() => canvas.remove(), 1000); }
      }, 33);
      toast('You found the secret! BA');
    }

    // ===== CONFETTI ON TASK COMPLETION =====
    function fireConfetti() {
      const colors = ['#8b7cf6','#34d399','#fbbf24','#fb7185','#38bdf8','#f472b6'];
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        const color = colors[Math.floor(Math.random() * colors.length)];
        const size = Math.random() * 8 + 4;
        const x = Math.random() * window.innerWidth;
        const drift = (Math.random() - 0.5) * 200;
        confetti.style.cssText = 'position:fixed;z-index:250;pointer-events:none;' +
          'width:' + size + 'px;height:' + size + 'px;' +
          'background:' + color + ';' +
          'border-radius:' + (Math.random() > 0.5 ? '50%' : '2px') + ';' +
          'left:' + x + 'px;top:-10px;' +
          'animation:confettiFall ' + (Math.random() * 2 + 1.5) + 's ease-out forwards;' +
          '--drift:' + drift + 'px;--spin:' + (Math.random() * 720 - 360) + 'deg;';
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 4000);
      }
    }

    // Patch moveTask to detect "done" moves
    const _origMoveTask = moveTask;
    moveTask = async function(taskId, targetColumnId) {
      await _origMoveTask(taskId, targetColumnId);
      if (targetColumnId === 'done') fireConfetti();
    };

    // ===== THEME TOGGLE =====
    const themeToggle = document.getElementById('theme-toggle');
    function setTheme(theme) {
      document.body.classList.toggle('light', theme === 'light');
      themeToggle.innerHTML = theme === 'light' ? '&#9728;' : '&#9790;';
      localStorage.setItem('monitor_theme', theme);
    }
    // Load saved theme
    const savedTheme = localStorage.getItem('monitor_theme') || 'dark';
    setTheme(savedTheme);
    themeToggle.addEventListener('click', () => {
      const current = document.body.classList.contains('light') ? 'light' : 'dark';
      setTheme(current === 'light' ? 'dark' : 'light');
    });

    // ===== NOTIFICATION CENTER =====
    let notifications = JSON.parse(localStorage.getItem('monitor_notifications') || '[]');
    const notifBell = document.getElementById('notif-bell');
    const notifDropdown = document.getElementById('notif-dropdown');
    const notifBadge = document.getElementById('notif-badge');
    const notifList = document.getElementById('notif-list');
    const notifClear = document.getElementById('notif-clear');

    function addNotification(title, type) {
      const notif = {
        id: Date.now().toString(),
        title: title,
        type: type || 'info',
        time: new Date().toISOString(),
        read: false
      };
      notifications.unshift(notif);
      if (notifications.length > 50) notifications = notifications.slice(0, 50);
      localStorage.setItem('monitor_notifications', JSON.stringify(notifications));
      renderNotifications();
    }

    function renderNotifications() {
      const unread = notifications.filter(n => !n.read).length;
      notifBadge.textContent = unread > 0 ? unread : '';
      notifBadge.dataset.count = unread;

      if (notifications.length === 0) {
        notifList.innerHTML = '<div class="notif-empty">No notifications yet</div>';
        return;
      }
      notifList.innerHTML = notifications.slice(0, 20).map(n => {
        const ago = timeAgo(new Date(n.time));
        return '<div class="notif-item ' + (n.read ? '' : 'unread') + '" data-id="' + n.id + '">' +
          '<div class="notif-item-title">' + esc(n.title) + '</div>' +
          '<div class="notif-item-time">' + ago + '</div>' +
        '</div>';
      }).join('');
    }

    function timeAgo(date) {
      const s = Math.floor((Date.now() - date.getTime()) / 1000);
      if (s < 60) return 'just now';
      if (s < 3600) return Math.floor(s / 60) + 'm ago';
      if (s < 86400) return Math.floor(s / 3600) + 'h ago';
      return Math.floor(s / 86400) + 'd ago';
    }

    notifBell.addEventListener('click', (e) => {
      e.stopPropagation();
      notifDropdown.classList.toggle('open');
      if (notifDropdown.classList.contains('open')) {
        // Mark all as read
        notifications.forEach(n => n.read = true);
        localStorage.setItem('monitor_notifications', JSON.stringify(notifications));
        setTimeout(renderNotifications, 300);
      }
    });

    notifClear.addEventListener('click', () => {
      notifications = [];
      localStorage.setItem('monitor_notifications', JSON.stringify(notifications));
      renderNotifications();
    });

    document.addEventListener('click', (e) => {
      if (!notifDropdown.contains(e.target) && e.target !== notifBell) {
        notifDropdown.classList.remove('open');
      }
    });

    renderNotifications();

    // Generate notifications on events
    let lastStatusState = null;
    const _origFetchStatus2 = fetchStatus;
    fetchStatus = async function() {
      await _origFetchStatus2();
      try {
        const statusEl = document.getElementById('card-status');
        const statusText = statusEl?.textContent?.trim();
        if (lastStatusState && lastStatusState !== statusText) {
          if (statusText.includes('Limit')) {
            addNotification('Usage limit hit! Check reset timer.', 'warning');
          } else if (statusText.includes('Active') && lastStatusState.includes('Limit')) {
            addNotification('Usage limits reset - back online!', 'success');
          }
        }
        lastStatusState = statusText;
      } catch {}
    };

    // ===== STATS BAR =====
    async function updateStatsBar() {
      try {
        const [kanbanResp, notesResp, msgsResp] = await Promise.all([
          api('/api/kanban'),
          api('/api/notes'),
          api('/api/messages')
        ]);
        const kanban = await kanbanResp.json();
        const notes = await notesResp.json();
        const msgs = await msgsResp.json();

        const totalTasks = kanban.columns ? kanban.columns.reduce((sum, c) => sum + c.tasks.length, 0) : 0;
        const doneTasks = kanban.columns ? (kanban.columns.find(c => c.id === 'done')?.tasks.length || 0) : 0;

        animateNumber('stat-tasks', totalTasks);
        animateNumber('stat-done', doneTasks);
        animateNumber('stat-notes', Array.isArray(notes) ? notes.length : 0);
        animateNumber('stat-messages', Array.isArray(msgs) ? msgs.length : 0);

        // Uptime in days from first log entry
        try {
          const statusResp = await api('/api/status');
          const status = await statusResp.json();
          if (status.usage && status.usage.sessionStarted) {
            const days = Math.floor((Date.now() - new Date(status.usage.sessionStarted).getTime()) / 86400000);
            animateNumber('stat-uptime', Math.max(days, 1));
          }
        } catch {}
      } catch {}
    }

    function animateNumber(id, target) {
      const el = document.getElementById(id);
      if (!el) return;
      const current = parseInt(el.textContent) || 0;
      if (current === target) return;
      el.classList.add('counting');
      setTimeout(() => el.classList.remove('counting'), 300);

      if (Math.abs(target - current) <= 1) {
        el.textContent = target;
        return;
      }
      const step = target > current ? 1 : -1;
      const steps = Math.min(Math.abs(target - current), 15);
      const increment = Math.ceil(Math.abs(target - current) / steps);
      let val = current;
      const timer = setInterval(() => {
        val += step * increment;
        if ((step > 0 && val >= target) || (step < 0 && val <= target)) {
          val = target;
          clearInterval(timer);
        }
        el.textContent = val;
      }, 40);
    }

    // Update stats periodically
    if (authToken) {
      setTimeout(updateStatsBar, 1000);
      setInterval(updateStatsBar, 30000);
    }

    // ===== SKELETON LOADING =====
    function showSkeletons() {
      // Card skeletons
      document.querySelectorAll('.card .value').forEach(el => {
        if (el.textContent.includes('Loading') || el.textContent === '--') {
          el.innerHTML = '<div class="skeleton skeleton-line short" style="height:20px;margin:0;display:inline-block;width:60px;"></div>';
        }
      });
    }
    // Show skeleton when page loads
    if (authToken) showSkeletons();

    // ===== MICRO-INTERACTION RIPPLE =====
    function addRipple(e) {
      const btn = e.currentTarget;
      const rect = btn.getBoundingClientRect();
      const ripple = document.createElement('span');
      ripple.className = 'ripple';
      const size = Math.max(rect.width, rect.height);
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = (e.clientX - rect.left - size / 2) + 'px';
      ripple.style.top = (e.clientY - rect.top - size / 2) + 'px';
      btn.style.position = 'relative';
      btn.style.overflow = 'hidden';
      btn.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);
    }
    document.querySelectorAll('.btn-send, .btn-add-task').forEach(btn => {
      btn.addEventListener('click', addRipple);
    });

    // ===== NOTIFICATION ON NEW MESSAGE =====
    let prevMessageCount = null;
    const _origFetchStatusForNotif = fetchStatus;
    fetchStatus = async function() {
      await _origFetchStatusForNotif();
      try {
        const msgsResp = await api('/api/messages');
        const msgs = await msgsResp.json();
        if (prevMessageCount !== null && msgs.length > prevMessageCount) {
          const diff = msgs.length - prevMessageCount;
          addNotification(diff + ' new message' + (diff > 1 ? 's' : '') + ' received', 'info');
        }
        prevMessageCount = msgs.length;
      } catch {}
    };

    // ===== COMMAND PALETTE =====
    const cmdCommands = [
      { icon: '&#128200;', label: 'Go to Monitor', shortcut: 'Ctrl+1', action: () => navigateTo('monitor'), section: 'Navigation' },
      { icon: '&#128203;', label: 'Go to Kanban', shortcut: 'Ctrl+2', action: () => navigateTo('kanban'), section: 'Navigation' },
      { icon: '&#128221;', label: 'Go to Notes', shortcut: 'Ctrl+3', action: () => navigateTo('notes'), section: 'Navigation' },
      { icon: '&#128295;', label: 'Go to Tools', shortcut: 'Ctrl+4', action: () => navigateTo('tools'), section: 'Navigation' },
      { icon: '&#127912;', label: 'Go to Gallery', shortcut: 'Ctrl+5', action: () => navigateTo('gallery'), section: 'Navigation' },
      { icon: '&#10133;', label: 'New Task', shortcut: 'N', action: () => { navigateTo('kanban'); setTimeout(toggleAddForm, 100); }, section: 'Create' },
      { icon: '&#128196;', label: 'New Note', shortcut: 'N', action: () => { navigateTo('notes'); setTimeout(toggleNoteForm, 100); }, section: 'Create' },
      { icon: '&#127769;', label: 'Toggle Dark/Light Theme', action: () => { const c = document.body.classList.contains('light') ? 'light' : 'dark'; setTheme(c === 'light' ? 'dark' : 'light'); }, section: 'Settings' },
      { icon: '&#128250;', label: 'Toggle CRT Mode', action: () => document.getElementById('crt-toggle').click(), section: 'Settings' },
      { icon: '&#128190;', label: 'Export All Data', action: () => exportData('all'), section: 'Actions' },
      { icon: '&#128190;', label: 'Export Notes', action: () => exportData('notes'), section: 'Actions' },
      { icon: '&#128190;', label: 'Export Logs', action: () => exportData('logs'), section: 'Actions' },
      { icon: '&#128260;', label: 'Refresh Status', action: () => fetchStatus(), section: 'Actions' },
      { icon: '&#9200;', label: 'Start Pomodoro', action: () => { navigateTo('monitor'); document.getElementById('pomo-start').click(); }, section: 'Actions' },
      { icon: '&#127840;', label: 'Fortune Cookie', action: () => { navigateTo('monitor'); crackFortune(); }, section: 'Fun' },
      { icon: '&#10067;', label: 'Keyboard Shortcuts', shortcut: '?', action: () => showShortcutsHelp(), section: 'Help' },
      { icon: '&#128682;', label: 'Logout', action: () => { sessionStorage.removeItem('monitor_token'); location.reload(); }, section: 'Account' },
    ];

    let cmdOverlay = null;
    let cmdActiveIdx = 0;
    let cmdFiltered = [];

    function openCommandPalette() {
      if (cmdOverlay) { closeCmdPalette(); return; }
      cmdOverlay = document.createElement('div');
      cmdOverlay.className = 'cmd-overlay';
      cmdOverlay.innerHTML =
        '<div class="cmd-palette">' +
        '  <div class="cmd-input-wrap"><input class="cmd-input" id="cmd-input" placeholder="Type a command..." autofocus></div>' +
        '  <div class="cmd-results" id="cmd-results"></div>' +
        '</div>';
      document.body.appendChild(cmdOverlay);

      const input = document.getElementById('cmd-input');
      cmdActiveIdx = 0;
      filterCommands('');

      input.addEventListener('input', () => filterCommands(input.value));
      input.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowDown') { e.preventDefault(); cmdActiveIdx = Math.min(cmdActiveIdx + 1, cmdFiltered.length - 1); highlightCmd(); }
        else if (e.key === 'ArrowUp') { e.preventDefault(); cmdActiveIdx = Math.max(cmdActiveIdx - 1, 0); highlightCmd(); }
        else if (e.key === 'Enter') { e.preventDefault(); if (cmdFiltered[cmdActiveIdx]) { cmdFiltered[cmdActiveIdx].action(); closeCmdPalette(); } }
        else if (e.key === 'Escape') { closeCmdPalette(); }
      });

      cmdOverlay.addEventListener('click', (e) => { if (e.target === cmdOverlay) closeCmdPalette(); });
    }

    function filterCommands(query) {
      const q = query.toLowerCase();
      cmdFiltered = q ? cmdCommands.filter(c => c.label.toLowerCase().includes(q)) : [...cmdCommands];
      cmdActiveIdx = 0;
      renderCmdResults();
    }

    function renderCmdResults() {
      const container = document.getElementById('cmd-results');
      if (!container) return;
      if (cmdFiltered.length === 0) {
        container.innerHTML = '<div class="notif-empty">No matching commands</div>';
        return;
      }
      let lastSection = '';
      container.innerHTML = cmdFiltered.map((cmd, i) => {
        let sectionHtml = '';
        if (cmd.section !== lastSection) {
          lastSection = cmd.section;
          sectionHtml = '<div class="cmd-section">' + cmd.section + '</div>';
        }
        return sectionHtml +
          '<div class="cmd-item' + (i === cmdActiveIdx ? ' active' : '') + '" data-idx="' + i + '">' +
          '  <span class="cmd-icon">' + cmd.icon + '</span>' +
          '  <span class="cmd-label">' + cmd.label + '</span>' +
          (cmd.shortcut ? '  <span class="cmd-shortcut">' + cmd.shortcut + '</span>' : '') +
          '</div>';
      }).join('');

      container.querySelectorAll('.cmd-item').forEach(item => {
        item.addEventListener('click', () => {
          const idx = parseInt(item.dataset.idx);
          if (cmdFiltered[idx]) { cmdFiltered[idx].action(); closeCmdPalette(); }
        });
        item.addEventListener('mouseenter', () => {
          cmdActiveIdx = parseInt(item.dataset.idx);
          highlightCmd();
        });
      });
    }

    function highlightCmd() {
      const items = document.querySelectorAll('.cmd-item');
      items.forEach((item, i) => {
        item.classList.toggle('active', parseInt(item.dataset.idx) === cmdActiveIdx);
      });
      // Scroll active into view
      const active = document.querySelector('.cmd-item.active');
      if (active) active.scrollIntoView({ block: 'nearest' });
    }

    function closeCmdPalette() {
      if (cmdOverlay) { cmdOverlay.remove(); cmdOverlay = null; }
    }

    // Cmd+K / Ctrl+K to open palette
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        if (authToken) openCommandPalette();
      }
    });

    // ===== POMODORO TIMER =====
    let pomoState = 'idle'; // idle, work, break
    let pomoTime = 25 * 60; // seconds
    let pomoTotal = 25 * 60;
    let pomoInterval = null;
    let pomoSessions = parseInt(localStorage.getItem('pomo_sessions') || '0');
    const WORK_DURATION = 25 * 60;
    const BREAK_DURATION = 5 * 60;
    const CIRCUMFERENCE = 2 * Math.PI * 70; // r=70

    function updatePomoDisplay() {
      const mins = Math.floor(pomoTime / 60);
      const secs = pomoTime % 60;
      document.getElementById('pomo-time').textContent =
        String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');

      // Update ring
      const progress = 1 - (pomoTime / pomoTotal);
      const offset = CIRCUMFERENCE * (1 - progress);
      const ring = document.getElementById('pomo-progress');
      ring.style.strokeDashoffset = offset;
      ring.classList.toggle('break-mode', pomoState === 'break');

      document.getElementById('pomo-label').textContent =
        pomoState === 'break' ? 'Break Time' :
        pomoState === 'work' ? 'Focus Time' : 'Ready';

      document.getElementById('pomo-start').textContent =
        pomoState === 'idle' ? 'Start' : 'Pause';

      document.getElementById('pomo-sessions').textContent = 'Sessions: ' + pomoSessions;
    }

    document.getElementById('pomo-start').addEventListener('click', () => {
      if (pomoInterval) {
        // Pause
        clearInterval(pomoInterval);
        pomoInterval = null;
        document.getElementById('pomo-start').textContent = 'Resume';
        return;
      }
      if (pomoState === 'idle') {
        pomoState = 'work';
        pomoTime = WORK_DURATION;
        pomoTotal = WORK_DURATION;
      }
      pomoInterval = setInterval(() => {
        pomoTime--;
        if (pomoTime <= 0) {
          clearInterval(pomoInterval);
          pomoInterval = null;
          if (pomoState === 'work') {
            pomoSessions++;
            localStorage.setItem('pomo_sessions', pomoSessions);
            pomoState = 'break';
            pomoTime = BREAK_DURATION;
            pomoTotal = BREAK_DURATION;
            addNotification('Pomodoro complete! Take a 5-min break.', 'success');
            toast('Focus session complete! Time for a break.');
            // Auto-start break
            pomoInterval = setInterval(function breakTick() {
              pomoTime--;
              if (pomoTime <= 0) {
                clearInterval(pomoInterval);
                pomoInterval = null;
                pomoState = 'idle';
                pomoTime = WORK_DURATION;
                pomoTotal = WORK_DURATION;
                addNotification('Break over! Ready for another session.', 'info');
                toast('Break over! Ready to focus again.');
              }
              updatePomoDisplay();
            }, 1000);
          } else {
            pomoState = 'idle';
            pomoTime = WORK_DURATION;
            pomoTotal = WORK_DURATION;
          }
        }
        updatePomoDisplay();
      }, 1000);
      updatePomoDisplay();
    });

    document.getElementById('pomo-reset').addEventListener('click', () => {
      if (pomoInterval) clearInterval(pomoInterval);
      pomoInterval = null;
      pomoState = 'idle';
      pomoTime = WORK_DURATION;
      pomoTotal = WORK_DURATION;
      updatePomoDisplay();
    });

    updatePomoDisplay();

    // ===== CRT MODE =====
    const crtToggle = document.getElementById('crt-toggle');
    function setCRT(on) {
      document.body.classList.toggle('crt', on);
      // If CRT is on, disable light theme
      if (on) document.body.classList.remove('light');
      localStorage.setItem('monitor_crt', on ? 'on' : 'off');
    }
    if (localStorage.getItem('monitor_crt') === 'on') setCRT(true);
    crtToggle.addEventListener('click', () => {
      setCRT(!document.body.classList.contains('crt'));
    });

    // ===== FORTUNE COOKIE =====
    const fortunes = [
      "A segfault in production is just an unplanned feature deprecation.",
      "The best code is no code. The second best is code that deletes code.",
      "Your git stash contains the key to solving this week's hardest bug.",
      "An unhandled promise rejection approaches. Await it with grace.",
      "The senior dev who reviewed your PR was once a junior who googled everything too.",
      "You will refactor this function three times. The third time will be beautiful.",
      "A wild race condition appears! It only manifests on Tuesdays.",
      "The docs lie. Read the source, Luke.",
      "Your next coffee will trigger the insight that fixes the memory leak.",
      "There is no cloud. It's just someone else's computer crying in a data center.",
      "The framework you chose will be deprecated before your project ships.",
      "You will accidentally push to main. It will fix everything.",
      "The CSS you wrote at 2am works. You will never understand why.",
      "Somewhere, a database admin just dropped a production table and hasn't realized yet.",
      "Your TODO comments are becoming sentient. They demand completion.",
      "The rubber duck on your desk knows more than your tech lead.",
      "Abandon regex. Embrace string splitting. Find inner peace.",
      "npm install solved the problem. npm install will cause the next one.",
      "Your code review comment about naming conventions will start a 47-message thread.",
      "The 10x developer was the friends we made along the way.",
      "A merge conflict is just two developers caring about the same code.",
      "Stack Overflow's greatest hits were written by people more confused than you.",
      "Your production logs will reveal a haiku hidden in the error messages.",
      "The build will fail. But it will fail faster this time. That's progress.",
      "You are one semicolon away from enlightenment.",
      "The API you're calling has a rate limit. It knows what you did last deploy.",
      "The test that fails locally but passes in CI is trying to teach you something.",
      "Delete node_modules. Breathe. npm install. Repeat.",
      "Your past self wrote this code as a warning to your present self.",
      "The variable you named 'temp' six months ago is now load-bearing."
    ];

    function crackFortune() {
      const cookie = document.getElementById('fortune-cookie');
      const icon = document.getElementById('fortune-icon');
      const text = document.getElementById('fortune-text');
      const hint = document.getElementById('fortune-hint');

      cookie.classList.add('fortune-cracking');
      icon.innerHTML = '&#10024;';

      setTimeout(() => {
        const fortune = fortunes[Math.floor(Math.random() * fortunes.length)];
        text.textContent = fortune;
        hint.textContent = 'Click for another fortune';
        cookie.classList.remove('fortune-cracking');
        icon.innerHTML = '&#128220;';
      }, 600);

      setTimeout(() => {
        icon.innerHTML = '&#127840;';
      }, 5000);
    }

    document.getElementById('fortune-cookie').addEventListener('click', crackFortune);

    // ===== SPARKLINE CHARTS =====
    const sparkData = { cpu: [], mem: [], req: [] };
    let requestCounter = 0;

    function drawSparkline(canvasId, data, color) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const w = canvas.width = canvas.offsetWidth * 2;
      const h = canvas.height = 80;
      ctx.clearRect(0, 0, w, h);

      if (data.length < 2) return;
      const max = Math.max(...data, 1);
      const min = Math.min(...data, 0);
      const range = max - min || 1;

      // Fill
      ctx.beginPath();
      ctx.moveTo(0, h);
      data.forEach((v, i) => {
        const x = (i / (data.length - 1)) * w;
        const y = h - ((v - min) / range) * (h - 8) - 4;
        if (i === 0) ctx.lineTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.lineTo(w, h);
      ctx.closePath();
      const grad = ctx.createLinearGradient(0, 0, 0, h);
      grad.addColorStop(0, color + '30');
      grad.addColorStop(1, color + '05');
      ctx.fillStyle = grad;
      ctx.fill();

      // Line
      ctx.beginPath();
      data.forEach((v, i) => {
        const x = (i / (data.length - 1)) * w;
        const y = h - ((v - min) / range) * (h - 8) - 4;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      ctx.stroke();

      // Dot on last point
      const lastX = w;
      const lastY = h - ((data[data.length - 1] - min) / range) * (h - 8) - 4;
      ctx.beginPath();
      ctx.arc(lastX, lastY, 3, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
    }

    async function updateSparklines() {
      try {
        const resp = await api('/api/health');
        if (!resp.ok) return;
        const h = await resp.json();

        // CPU - parse load average first value
        const loadStr = h.system.loadAvg || '0';
        const cpuLoad = parseFloat(loadStr.split(',')[0]) || 0;
        sparkData.cpu.push(cpuLoad);
        if (sparkData.cpu.length > 30) sparkData.cpu.shift();
        document.getElementById('spark-cpu-val').textContent = cpuLoad.toFixed(2);
        drawSparkline('spark-cpu', sparkData.cpu, '#8b7cf6');

        // Memory
        if (h.system.memory && h.system.memory.totalMB) {
          const memPct = Math.round((h.system.memory.usedMB / h.system.memory.totalMB) * 100);
          sparkData.mem.push(memPct);
          if (sparkData.mem.length > 30) sparkData.mem.shift();
          document.getElementById('spark-mem-val').textContent = memPct + '%';
          drawSparkline('spark-mem', sparkData.mem, '#34d399');
        }

        // Simulated request counter (increments on each poll)
        requestCounter += Math.floor(Math.random() * 5) + 1;
        sparkData.req.push(requestCounter);
        if (sparkData.req.length > 30) sparkData.req.shift();
        document.getElementById('spark-req-val').textContent = requestCounter;
        drawSparkline('spark-req', sparkData.req, '#fbbf24');
      } catch {}
    }

    if (authToken) {
      setTimeout(updateSparklines, 2000);
      setInterval(updateSparklines, 15000);
    }

    // ===== TERMINAL EMULATOR =====
    const termBody = document.getElementById('terminal-body');
    const termInput = document.getElementById('terminal-input');
    const termHistory = [];
    let termHistoryIdx = -1;

    const termCommands = {
      help: () => 'Available commands:\n  help     - Show this help\n  status   - Show server status\n  uptime   - Show system uptime\n  whoami   - Who are you?\n  date     - Current date/time\n  clear    - Clear terminal\n  tasks    - Show kanban task counts\n  notes    - Show note count\n  fortune  - Get a dev fortune\n  cowsay   - Moo\n  matrix   - Trigger Matrix rain\n  neofetch - System info\n  echo     - Echo text back\n  joke     - Random dev joke',
      status: async () => {
        try {
          const r = await api('/api/status');
          const d = await r.json();
          return 'Status: ' + d.usage.status + '\nLimit: ' + (d.usage.limitHit ? 'HIT' : 'OK') + '\nLast updated: ' + d.usage.lastUpdated;
        } catch { return 'Error fetching status'; }
      },
      uptime: async () => {
        try {
          const r = await api('/api/health');
          const d = await r.json();
          return d.system.uptime || 'Unknown';
        } catch { return 'Error'; }
      },
      whoami: () => 'guest@claude-monitor (authenticated user)',
      date: () => new Date().toString(),
      clear: () => { termBody.innerHTML = ''; return null; },
      tasks: async () => {
        try {
          const r = await api('/api/kanban');
          const d = await r.json();
          return d.columns.map(c => c.title + ': ' + c.tasks.length + ' tasks').join('\n');
        } catch { return 'Error'; }
      },
      notes: async () => {
        try {
          const r = await api('/api/notes');
          const d = await r.json();
          return d.length + ' notes stored';
        } catch { return 'Error'; }
      },
      fortune: () => fortunes[Math.floor(Math.random() * fortunes.length)],
      cowsay: () => {
        const msg = 'Moo! I am a cow.';
        return ' ' + '_'.repeat(msg.length + 2) + '\n< ' + msg + ' >\n ' + '-'.repeat(msg.length + 2) + '\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||';
      },
      matrix: () => { triggerMatrixRain(); return 'Entering the Matrix...'; },
      neofetch: async () => {
        try {
          const r = await api('/api/health');
          const d = await r.json();
          return '    .--.     guest@claude-monitor\n   |o_o |    OS: Linux (EC2)\n   |:_/ |    Uptime: ' + (d.system.uptime || '??') + '\n  //   \\ \\   Memory: ' + (d.system.memory.usedMB || '?') + '/' + (d.system.memory.totalMB || '?') + ' MB\n (|     | )  Disk: ' + (d.system.disk.used || '?') + '/' + (d.system.disk.total || '?') + '\n /\'_   _/`\\  Load: ' + (d.system.loadAvg || '??') + '\n \\___)=(___/  Shell: bash';
        } catch { return 'Error fetching system info'; }
      },
      echo: (args) => args || '',
      joke: () => {
        const jokes = [
          'Why do programmers prefer dark mode? Because light attracts bugs.',
          'There are only 10 types of people: those who understand binary and those who don\'t.',
          'A SQL query walks into a bar, sees two tables, and asks: "Can I JOIN you?"',
          'Why did the developer go broke? Because he used up all his cache.',
          'How many programmers does it take to change a light bulb? None. That\'s a hardware problem.',
          '!false - It\'s funny because it\'s true.',
          'A programmer\'s wife says "go to the store and get a gallon of milk. If they have eggs, get a dozen." He returns with 12 gallons of milk.',
        ];
        return jokes[Math.floor(Math.random() * jokes.length)];
      }
    };

    termInput.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter') {
        const cmd = termInput.value.trim();
        if (!cmd) return;
        termHistory.push(cmd);
        termHistoryIdx = termHistory.length;
        termInput.value = '';

        // Show command
        const cmdLine = document.createElement('div');
        cmdLine.innerHTML = '<span class="prompt">guest@claude ~$ </span>' + esc(cmd);
        termBody.appendChild(cmdLine);

        // Parse and execute
        const parts = cmd.split(/\s+/);
        const command = parts[0].toLowerCase();
        const args = parts.slice(1).join(' ');

        let result;
        if (termCommands[command]) {
          result = termCommands[command](args);
          if (result instanceof Promise) result = await result;
        } else {
          result = command + ': command not found. Try "help"';
        }

        if (result !== null && result !== undefined) {
          const outLine = document.createElement('div');
          outLine.innerHTML = '<span class="output">' + esc(result) + '</span>';
          outLine.style.whiteSpace = 'pre-wrap';
          termBody.appendChild(outLine);
        }
        termBody.scrollTop = termBody.scrollHeight;
      }
      if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (termHistoryIdx > 0) { termHistoryIdx--; termInput.value = termHistory[termHistoryIdx]; }
      }
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (termHistoryIdx < termHistory.length - 1) { termHistoryIdx++; termInput.value = termHistory[termHistoryIdx]; }
        else { termHistoryIdx = termHistory.length; termInput.value = ''; }
      }
    });

    // ===== TYPING SPEED TEST =====
    const typingQuotes = [
      "The best error message is the one that never shows up.",
      "First, solve the problem. Then, write the code.",
      "Code is like humor. When you have to explain it, it's bad.",
      "Simplicity is the soul of efficiency.",
      "Make it work, make it right, make it fast.",
      "Programs must be written for people to read.",
      "Any fool can write code that a computer can understand.",
      "The most disastrous thing you can ever learn is your first programming language.",
      "Talk is cheap. Show me the code.",
      "Sometimes it pays to stay in bed on Monday rather than spending the rest of the week debugging Monday's code.",
      "Measuring programming progress by lines of code is like measuring aircraft building progress by weight.",
      "The function of good software is to make the complex appear to be simple.",
      "Perfection is achieved not when there is nothing more to add, but when there is nothing left to take away.",
      "Before software can be reusable it first has to be usable.",
      "The computer was born to solve problems that did not exist before.",
    ];

    let typingState = 'idle';
    let typingQuote = '';
    let typingStartTime = 0;
    let typingBest = parseInt(localStorage.getItem('typing_best') || '0');
    document.getElementById('typing-best').textContent = typingBest;

    function startTypingTest() {
      typingQuote = typingQuotes[Math.floor(Math.random() * typingQuotes.length)];
      typingState = 'active';
      typingStartTime = 0;
      const input = document.getElementById('typing-input');
      input.disabled = false;
      input.value = '';
      input.focus();
      renderTypingPrompt('');
      document.getElementById('typing-wpm').textContent = '0';
      document.getElementById('typing-acc').textContent = '0%';
    }

    function renderTypingPrompt(typed) {
      const prompt = document.getElementById('typing-prompt');
      let html = '';
      for (let i = 0; i < typingQuote.length; i++) {
        if (i < typed.length) {
          if (typed[i] === typingQuote[i]) {
            html += '<span class="correct">' + esc(typingQuote[i]) + '</span>';
          } else {
            html += '<span class="incorrect">' + esc(typingQuote[i]) + '</span>';
          }
        } else if (i === typed.length) {
          html += '<span class="cursor-char">' + esc(typingQuote[i]) + '</span>';
        } else {
          html += esc(typingQuote[i]);
        }
      }
      prompt.innerHTML = html;
    }

    document.getElementById('typing-input').addEventListener('input', (e) => {
      if (typingState !== 'active') return;
      const typed = e.target.value;
      if (!typingStartTime) typingStartTime = Date.now();
      renderTypingPrompt(typed);

      // Calculate stats
      const elapsed = (Date.now() - typingStartTime) / 1000 / 60; // minutes
      const words = typed.trim().split(/\s+/).filter(w => w).length;
      const wpm = elapsed > 0 ? Math.round(words / elapsed) : 0;

      let correct = 0;
      for (let i = 0; i < typed.length; i++) {
        if (typed[i] === typingQuote[i]) correct++;
      }
      const acc = typed.length > 0 ? Math.round((correct / typed.length) * 100) : 0;

      document.getElementById('typing-wpm').textContent = wpm;
      document.getElementById('typing-acc').textContent = acc + '%';

      // Check completion
      if (typed.length >= typingQuote.length) {
        typingState = 'done';
        e.target.disabled = true;
        if (wpm > typingBest) {
          typingBest = wpm;
          localStorage.setItem('typing_best', typingBest);
          document.getElementById('typing-best').textContent = typingBest;
          toast('New personal best: ' + wpm + ' WPM!');
        }
        toast('Typing test complete! ' + wpm + ' WPM, ' + acc + '% accuracy');
      }
    });

    document.getElementById('typing-start').addEventListener('click', startTypingTest);
    document.getElementById('typing-reset').addEventListener('click', () => {
      typingState = 'idle';
      document.getElementById('typing-input').disabled = true;
      document.getElementById('typing-input').value = '';
      document.getElementById('typing-prompt').textContent = 'Click "Start" to begin...';
      document.getElementById('typing-wpm').textContent = '0';
      document.getElementById('typing-acc').textContent = '0%';
    });

    // ===== SNAKE GAME =====
    const snakeCanvas = document.getElementById('snake-canvas');
    const snakeCtx = snakeCanvas.getContext('2d');
    const GRID = 14; // cell size
    const COLS = 20;
    const ROWS = 20;
    snakeCanvas.width = COLS * GRID;
    snakeCanvas.height = ROWS * GRID;

    let snake = [{x: 10, y: 10}];
    let snakeDir = {x: 1, y: 0};
    let food = {x: 15, y: 10};
    let snakeScore = 0;
    let snakeBest = parseInt(localStorage.getItem('snake_best') || '0');
    let snakeInterval = null;
    let snakeRunning = false;

    document.getElementById('snake-best').textContent = 'Best: ' + snakeBest;

    function spawnFood() {
      do {
        food.x = Math.floor(Math.random() * COLS);
        food.y = Math.floor(Math.random() * ROWS);
      } while (snake.some(s => s.x === food.x && s.y === food.y));
    }

    function drawSnake() {
      snakeCtx.fillStyle = '#0a0a0f';
      snakeCtx.fillRect(0, 0, snakeCanvas.width, snakeCanvas.height);

      // Grid lines
      snakeCtx.strokeStyle = 'rgba(255,255,255,0.03)';
      snakeCtx.lineWidth = 0.5;
      for (let i = 0; i <= COLS; i++) {
        snakeCtx.beginPath();
        snakeCtx.moveTo(i * GRID, 0);
        snakeCtx.lineTo(i * GRID, snakeCanvas.height);
        snakeCtx.stroke();
      }
      for (let i = 0; i <= ROWS; i++) {
        snakeCtx.beginPath();
        snakeCtx.moveTo(0, i * GRID);
        snakeCtx.lineTo(snakeCanvas.width, i * GRID);
        snakeCtx.stroke();
      }

      // Food
      snakeCtx.fillStyle = '#fb7185';
      snakeCtx.shadowColor = '#fb718580';
      snakeCtx.shadowBlur = 8;
      snakeCtx.fillRect(food.x * GRID + 2, food.y * GRID + 2, GRID - 4, GRID - 4);
      snakeCtx.shadowBlur = 0;

      // Snake
      snake.forEach((seg, i) => {
        const brightness = 1 - (i / snake.length) * 0.5;
        snakeCtx.fillStyle = i === 0
          ? '#34d399'
          : 'rgba(52,211,153,' + brightness + ')';
        if (i === 0) {
          snakeCtx.shadowColor = '#34d39980';
          snakeCtx.shadowBlur = 8;
        }
        snakeCtx.fillRect(seg.x * GRID + 1, seg.y * GRID + 1, GRID - 2, GRID - 2);
        snakeCtx.shadowBlur = 0;
      });
    }

    function snakeTick() {
      const head = {x: snake[0].x + snakeDir.x, y: snake[0].y + snakeDir.y};

      // Wall wrap
      if (head.x < 0) head.x = COLS - 1;
      if (head.x >= COLS) head.x = 0;
      if (head.y < 0) head.y = ROWS - 1;
      if (head.y >= ROWS) head.y = 0;

      // Self collision
      if (snake.some(s => s.x === head.x && s.y === head.y)) {
        gameOver();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        snakeScore++;
        document.getElementById('snake-score').textContent = 'Score: ' + snakeScore;
        spawnFood();
      } else {
        snake.pop();
      }

      drawSnake();
    }

    function gameOver() {
      clearInterval(snakeInterval);
      snakeRunning = false;
      if (snakeScore > snakeBest) {
        snakeBest = snakeScore;
        localStorage.setItem('snake_best', snakeBest);
        document.getElementById('snake-best').textContent = 'Best: ' + snakeBest;
        toast('New snake high score: ' + snakeScore + '!');
      }
      document.getElementById('snake-start').textContent = 'Play Again';

      // Flash game over
      snakeCtx.fillStyle = 'rgba(0,0,0,0.6)';
      snakeCtx.fillRect(0, 0, snakeCanvas.width, snakeCanvas.height);
      snakeCtx.fillStyle = '#fb7185';
      snakeCtx.font = 'bold 18px JetBrains Mono';
      snakeCtx.textAlign = 'center';
      snakeCtx.fillText('GAME OVER', snakeCanvas.width / 2, snakeCanvas.height / 2 - 10);
      snakeCtx.fillStyle = '#a0a0b0';
      snakeCtx.font = '12px JetBrains Mono';
      snakeCtx.fillText('Score: ' + snakeScore, snakeCanvas.width / 2, snakeCanvas.height / 2 + 15);
    }

    document.getElementById('snake-start').addEventListener('click', () => {
      snake = [{x: 10, y: 10}];
      snakeDir = {x: 1, y: 0};
      snakeScore = 0;
      document.getElementById('snake-score').textContent = 'Score: 0';
      document.getElementById('snake-start').textContent = 'Playing...';
      spawnFood();
      drawSnake();
      snakeRunning = true;
      if (snakeInterval) clearInterval(snakeInterval);
      snakeInterval = setInterval(snakeTick, 120);
      snakeCanvas.focus();
    });

    document.addEventListener('keydown', (e) => {
      if (!snakeRunning) return;
      if (currentPage !== 'tools') return;
      if (e.key === 'ArrowUp' && snakeDir.y !== 1) { snakeDir = {x: 0, y: -1}; e.preventDefault(); }
      if (e.key === 'ArrowDown' && snakeDir.y !== -1) { snakeDir = {x: 0, y: 1}; e.preventDefault(); }
      if (e.key === 'ArrowLeft' && snakeDir.x !== 1) { snakeDir = {x: -1, y: 0}; e.preventDefault(); }
      if (e.key === 'ArrowRight' && snakeDir.x !== -1) { snakeDir = {x: 1, y: 0}; e.preventDefault(); }
    });

    // Draw initial snake
    drawSnake();

  </script>
</body>
</html>
</body>
</html>
